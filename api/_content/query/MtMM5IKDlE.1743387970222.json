{"_path":"/2023/tailscale-incomplete-guide","_dir":"2023","_draft":false,"_partial":false,"_locale":"","title":"Tailscale 不完全使用指南","description":"Tailscale 搭建虚拟局域网，支持多设备间轻松实现 Windows 文件共享、SSH 访问、远程桌面及 Moonlight 游戏串流。","date":"2023-10-08T02:34:00.000Z","updated":"2024-05-16T00:30:47.000Z","image":"https://7.isyangs.cn/24/6664009cce512-24.jpg","categories":["经验分享"],"tags":["教程","tailscale","软件","远程"],"recommend":true,"readingTime":{"text":"6 min read","minutes":5.69,"time":341400,"words":1138},"body":{"type":"root","children":[{"type":"element","tag":"h2","props":{"id":"介绍"},"children":[{"type":"text","value":"介绍"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Tailscale是一款虚拟组网软件，它不需要公网IP地址，也不会像内网穿透软件过于依赖转发服务器的带宽，只需要安装、登录，你在Internet上的设备就会出现在同一局域网下。"}]},{"type":"element","tag":"blockquote","props":{},"children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"工作原理："}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"https://tailscale.com/blog/how-tailscale-works","rel":["nofollow"]},"children":[{"type":"text","value":"How Tailscale works"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"https://tailscale.com/blog/how-nat-traversal-works","rel":["nofollow"]},"children":[{"type":"text","value":"How NAT traversal works"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"这篇教程挺不错的，可以阅读一下："}]},{"type":"element","tag":"link-card","props":{"icon":"https://wsrv.nl/?url=github.com/Ghost-chu.png","link":"https://www.ghostchu.com/4200/tailscale-%e5%ae%89%e5%88%a9%e6%8c%87%e5%8d%97-%e5%bf%ab%e9%80%9f%e5%90%91%e4%bd%a0%e7%9a%84%e5%a5%bd%e5%8f%8b%e6%8e%a8%e9%94%80-tailscale/","title":"Tailscale 安利指南 - 快速向你的好友推销 Tailscale"},"children":[]},{"type":"element","tag":"h2","props":{"id":"安装"},"children":[{"type":"text","value":"安装"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"打开"},{"type":"element","tag":"a","props":{"href":"https://tailscale.com/","rel":["nofollow"]},"children":[{"type":"text","value":"Tailscale 官网"}]},{"type":"text","value":"，推荐使用微软账号认证登录，随后给各个设备安装软件，然后在设备上登录，即可进入同一内网环境。"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Windows 在安装、登录之后建议在任务栏上右键图标，在“Preferences”菜单中选择“Run unattended”，即可开机自启。"}]},{"type":"element","tag":"h2","props":{"id":"常用命令"},"children":[{"type":"text","value":"常用命令"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"检查Tailscale内网中到某主机的连通性，分为 DERP 中转和 IP 直连两种情况。\n"},{"type":"element","tag":"copy","props":{"code":"tailscale ping <host>"},"children":[]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"检查本机的网络环境。\n"},{"type":"element","tag":"copy","props":{"code":"tailscale netcheck"},"children":[]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"登录新账号，也可以把获取到的登录链接发给他人帮忙登录。\n"},{"type":"element","tag":"copy","props":{"code":"tailscale login"},"children":[]}]}]},{"type":"element","tag":"h2","props":{"id":"重启服务"},"children":[{"type":"text","value":"重启服务"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"有时 Tailscale 的直连会中断，变为 DERP 中转模式，此模式下延迟较高，若想以直连方式重连目标机器，可以重启目标机器上的 Tailscale 服务。"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"特别地，如果在 SSH 中重启服务，请注意 SSH 中断会导致重启失败，无法进行后续连接，所以需要另起一个与 SSH 无关的进程。Linux 中可以使用 "},{"type":"element","tag":"code","props":{"className":"language-sh shiki shiki-themes catppuccin-latte one-dark-pro","language":"sh","style":""},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#1E66F5;--shiki-default-font-style:italic;--shiki-dark:#61AFEF;--shiki-dark-font-style:inherit"},"children":[{"type":"text","value":"screen"}]}]},{"type":"text","value":" 命令，Windows 中可以执行这个脚本文件："}]},{"type":"element","tag":"pre","props":{"className":"language-bat shiki shiki-themes catppuccin-latte one-dark-pro","code":"%1 mshta vbscript:CreateObject(\"Shell.Application\").ShellExecute(\"cmd\",\"/c %~s0 ::\",\"\",\"runas\",1)(window.close) && exit\npowershell Invoke-WmiMethod Win32_Process Create \\\"powershell Restart-Service Tailscale\\\"\n","filename":"restart-tailscale.bat","language":"bat","meta":"","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#4C4F69;--shiki-default-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic"},"children":[{"type":"text","value":"%"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E64553;--shiki-default-font-style:italic;--shiki-dark:#E06C75;--shiki-dark-font-style:italic"},"children":[{"type":"text","value":"1"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#4C4F69;--shiki-dark:#ABB2BF"},"children":[{"type":"text","value":" mshta vbscript:CreateObject"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#7C7F93;--shiki-dark:#ABB2BF"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#40A02B;--shiki-dark:#98C379"},"children":[{"type":"text","value":"\"Shell.Application\""}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#7C7F93;--shiki-dark:#ABB2BF"},"children":[{"type":"text","value":")"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#4C4F69;--shiki-dark:#ABB2BF"},"children":[{"type":"text","value":".ShellExecute"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#7C7F93;--shiki-dark:#ABB2BF"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#40A02B;--shiki-dark:#98C379"},"children":[{"type":"text","value":"\"cmd\""}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#7C7F93;--shiki-dark:#ABB2BF"},"children":[{"type":"text","value":","}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#40A02B;--shiki-dark:#98C379"},"children":[{"type":"text","value":"\"/c "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#4C4F69;--shiki-default-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic"},"children":[{"type":"text","value":"%"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E64553;--shiki-default-font-style:italic;--shiki-dark:#E06C75;--shiki-dark-font-style:italic"},"children":[{"type":"text","value":"~s0"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#40A02B;--shiki-dark:#98C379"},"children":[{"type":"text","value":" ::\""}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#7C7F93;--shiki-dark:#ABB2BF"},"children":[{"type":"text","value":","}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#40A02B;--shiki-dark:#98C379"},"children":[{"type":"text","value":"\"\""}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#7C7F93;--shiki-dark:#ABB2BF"},"children":[{"type":"text","value":","}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#40A02B;--shiki-dark:#98C379"},"children":[{"type":"text","value":"\"runas\""}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#7C7F93;--shiki-dark:#ABB2BF"},"children":[{"type":"text","value":","}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#4C4F69;--shiki-dark:#ABB2BF"},"children":[{"type":"text","value":"1"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#7C7F93;--shiki-dark:#ABB2BF"},"children":[{"type":"text","value":")("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#4C4F69;--shiki-dark:#ABB2BF"},"children":[{"type":"text","value":"window.close"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#7C7F93;--shiki-dark:#ABB2BF"},"children":[{"type":"text","value":")"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#179299;--shiki-dark:#ABB2BF"},"children":[{"type":"text","value":" &&"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#8839EF;--shiki-dark:#C678DD"},"children":[{"type":"text","value":" exit\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#8839EF;--shiki-dark:#C678DD"},"children":[{"type":"text","value":"powershell"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#4C4F69;--shiki-dark:#ABB2BF"},"children":[{"type":"text","value":" Invoke-WmiMethod Win32_Process Create \\"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#40A02B;--shiki-dark:#98C379"},"children":[{"type":"text","value":"\"powershell Restart-Service Tailscale\\\"\n"}]}]}]}]},{"type":"element","tag":"h2","props":{"id":"传送文件"},"children":[{"type":"text","value":"传送文件"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"分享文件\n"},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"电脑：右键文件，选择“Send with Tailscale...”，随后选择设备。"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"手机：选择分享文件，选择“Tailscale”，随后选择设备。"}]}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"接收文件\n"},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"文件会自动出现在接收设备的系统默认下载目录中。"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Linux 系统输入 "},{"type":"element","tag":"code","props":{"className":"language-sh shiki shiki-themes catppuccin-latte one-dark-pro","language":"sh","style":""},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#1E66F5;--shiki-default-font-style:italic;--shiki-dark:#61AFEF;--shiki-dark-font-style:inherit"},"children":[{"type":"text","value":"sudo"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#40A02B;--shiki-dark:#98C379"},"children":[{"type":"text","value":" tailscale"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#40A02B;--shiki-dark:#98C379"},"children":[{"type":"text","value":" file"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#40A02B;--shiki-dark:#98C379"},"children":[{"type":"text","value":" get"}]}]},{"type":"text","value":" 接收文件。"}]}]}]}]},{"type":"element","tag":"h2","props":{"id":"windows-文件共享"},"children":[{"type":"text","value":"Windows 文件共享"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"在 Windows 设置中搜索“高级共享设置”，启用“文件和打印机共享”，关闭“密码保护的共享”。"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"在需要共享的文件夹的属性设置中启用共享。\n"},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"如果想让其他用户访问，则需要给对应的用户添加权限。"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"如果想免登录访问/修改，则需要给 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"Everyone"}]},{"type":"text","value":" 用户添加相应权限。"}]}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"在文件资源管理器的地址栏输入 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"\\\\主机名或者虚拟内网IP地址"}]},{"type":"text","value":"，即可访问共享文件夹。"}]}]},{"type":"element","tag":"h3","props":{"id":"使用适当的账号查看共享"},"children":[{"type":"text","value":"使用适当的账号查看共享"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"如果访问某些文件夹时，使用的账号没有对应的权限，则访问会被拒绝。你可以使用以下办法切换账号："}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"方法一：删除对应的Windows凭据\n"},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"在开始菜单中搜索“凭据”，进入“控制面板\\用户帐户\\凭据管理器\\管理 Windows 凭据”。"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"删除对应的用户账户，在命令行中输入 "},{"type":"element","tag":"code","props":{"className":"language-sh shiki shiki-themes catppuccin-latte one-dark-pro","language":"sh","style":""},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#1E66F5;--shiki-default-font-style:italic;--shiki-dark:#61AFEF;--shiki-dark-font-style:inherit"},"children":[{"type":"text","value":"net"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#40A02B;--shiki-dark:#98C379"},"children":[{"type":"text","value":" use"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#40A02B;--shiki-dark:#98C379"},"children":[{"type":"text","value":" /d"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#4C4F69;--shiki-dark:#E5C07B"},"children":[{"type":"text","value":" *"}]}]},{"type":"text","value":" 断开共享文件夹连接。"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"重新访问目标电脑的共享文件夹，应该会弹出登录窗口。"}]}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"方法二：通过映射网络驱动器切换账号\n"},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"在命令行中输入 "},{"type":"element","tag":"code","props":{"className":"language-sh shiki shiki-themes catppuccin-latte one-dark-pro","language":"sh","style":""},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#1E66F5;--shiki-default-font-style:italic;--shiki-dark:#61AFEF;--shiki-dark-font-style:inherit"},"children":[{"type":"text","value":"net"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#40A02B;--shiki-dark:#98C379"},"children":[{"type":"text","value":" use"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#40A02B;--shiki-dark:#98C379"},"children":[{"type":"text","value":" /d"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#4C4F69;--shiki-dark:#E5C07B"},"children":[{"type":"text","value":" *"}]}]},{"type":"text","value":"，断开先前的共享文件夹连接。"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"右键目标电脑的某一共享文件夹，选择“映射网络驱动器…”。"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"勾选“使用其他凭据连接”，输入用户名、密码，勾选“记住我的凭据”。"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"在文件资源管理器左侧树形导航（或者“此电脑”）中右键刚刚映射的网络驱动器，选择“断开连接”。"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"重新访问目标电脑的共享文件夹，应该会自动使用新用户登录。"}]}]}]}]},{"type":"element","tag":"h3","props":{"id":"在移动端访问"},"children":[{"type":"text","value":"在移动端访问"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"可以使用猫头鹰文件、MixExplorer、VLC 等软件，它们都支持 SMB 协议访问共享文件夹。你可以参考 "},{"type":"element","tag":"a","props":{"href":"/2024/link-util"},"children":[{"type":"text","value":"电脑连接手机，手机给电脑传文件……"}]},{"type":"text","value":"。"}]},{"type":"element","tag":"h2","props":{"id":"windows-openssh"},"children":[{"type":"text","value":"Windows OpenSSH"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"在Windows设置中选择“应用-可选功能-添加可选功能-查看功能”，找到“OpenSSH 服务器”，安装。"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"在开始菜单中搜索“服务”并打开，找到“OpenSSH SSH Server”，双击，启动类型选择“自动”，并且点击“启动”按钮。"}]},{"type":"element","tag":"h2","props":{"id":"windows-远程桌面"},"children":[{"type":"text","value":"Windows 远程桌面"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"远程桌面需要Windows专业版及以上的版本，如果是家庭版系统的话："}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"可以挂载专业版的安装镜像，然后选择保留数据升级。"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"可以使用 RDPWarp、SuperRDP2 之类的软件开启远程桌面服务。"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"在“Windows 设置-系统-远程桌面”中启用远程连接。"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"随后可以在客户端按下 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"Win+R"}]},{"type":"text","value":"，输入 "},{"type":"element","tag":"code","props":{"className":"language-cmd shiki shiki-themes catppuccin-latte one-dark-pro","language":"cmd","style":""},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#4C4F69;--shiki-dark:#ABB2BF"},"children":[{"type":"text","value":"mstsc"}]}]},{"type":"text","value":"，然后连接到主机名或者虚拟内网IP地址了。"}]},{"type":"element","tag":"h2","props":{"id":"moonlight-串流"},"children":[{"type":"text","value":"Moonlight 串流"}]},{"type":"element","tag":"link-banner","props":{"banner":"https://7.isyangs.cn/24/6664009b8f999-24.jpg","description":"服务端Sunshine设置、客户端分辨率调整、隐私屏功能实现及触摸优化。","link":"/2024/moonlight-streaming-guide","title":"Moonlight 串流指南"},"children":[]},{"type":"element","tag":"style","props":{},"children":[{"type":"text","value":"html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html.dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}"}]}],"toc":{"title":"","searchDepth":4,"depth":4,"links":[{"id":"介绍","depth":2,"text":"介绍"},{"id":"安装","depth":2,"text":"安装"},{"id":"常用命令","depth":2,"text":"常用命令"},{"id":"重启服务","depth":2,"text":"重启服务"},{"id":"传送文件","depth":2,"text":"传送文件"},{"id":"windows-文件共享","depth":2,"text":"Windows 文件共享","children":[{"id":"使用适当的账号查看共享","depth":3,"text":"使用适当的账号查看共享"},{"id":"在移动端访问","depth":3,"text":"在移动端访问"}]},{"id":"windows-openssh","depth":2,"text":"Windows OpenSSH"},{"id":"windows-远程桌面","depth":2,"text":"Windows 远程桌面"},{"id":"moonlight-串流","depth":2,"text":"Moonlight 串流"}]}},"_type":"markdown","_id":"content:posts:2023:tailscale-incomplete-guide.md","_source":"content","_file":"posts/2023/tailscale-incomplete-guide.md","_stem":"posts/2023/tailscale-incomplete-guide","_extension":"md","_original_dir":"/posts"}