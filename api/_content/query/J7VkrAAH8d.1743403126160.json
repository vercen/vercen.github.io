{"_path":"/2024/archlinux-boot-repair","_dir":"2024","_draft":false,"_partial":false,"_locale":"","title":"Arch Linux 启动引导修复","description":"可以修复绝大多数 Arch Linux 无法启动的问题。","date":"2024-04-01T15:14:39.000Z","updated":"2025-03-04T14:30:59.000Z","image":"https://7.isyangs.cn/24/66640097e0cbb-24.jpg","categories":["经验分享"],"tags":["教程","系统","archlinux"],"references":[{"title":"systemd-boot - Arch Linux 中文维基","link":"https://wiki.archlinuxcn.org/wiki/Systemd-boot"}],"readingTime":{"text":"3 min read","minutes":2.765,"time":165900,"words":553},"body":{"type":"root","children":[{"type":"element","tag":"h2","props":{"id":"制作启动盘进入并联网"},"children":[{"type":"text","value":"制作启动盘、进入并联网"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"参见 "},{"type":"element","tag":"a","props":{"href":"/2023/archinstall-guide"},"children":[{"type":"text","value":"使用 ArchInstall 安装 Arch Linux"}]},{"type":"text","value":" 的“安装前准备”一节。"}]},{"type":"element","tag":"h2","props":{"id":"挂载分区进入系统"},"children":[{"type":"text","value":"挂载分区、进入系统"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"如果不了解你的硬盘分区，可以执行以下命令：\n"},{"type":"element","tag":"copy","props":{"code":"lsblk -f","prompt":"#"},"children":[]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"先挂载根目录所在的分区：\n"},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"非 BtrFS 分区\n"},{"type":"element","tag":"copy","props":{"code":"mount /dev/[根分区] /mnt","prompt":"#"},"children":[]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"如果根分区使用 BtrFS，需要知道子卷名，如果没有子卷可以跳过此步\n"},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"可以通过先挂载 BtrFS，然后通过以下命令之一查看子卷名\n"},{"type":"element","tag":"copy","props":{"code":"ls /mnt","prompt":"#"},"children":[]},{"type":"element","tag":"copy","props":{"code":"btrfs subvolume list /[挂载点]","prompt":"#"},"children":[]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"随后解除 /mnt 的挂载并重新挂载对应的子卷\n"},{"type":"element","tag":"copy","props":{"code":"umount /mnt","prompt":"#"},"children":[]},{"type":"element","tag":"copy","props":{"code":"mount /dev/[根分区] -t btrfs -o subvol=[子卷名] /mnt","prompt":"#"},"children":[]}]}]}]}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"随后挂载其他分区：\n"},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"挂载启动分区\n"},{"type":"element","tag":"copy","props":{"code":"mount /dev/[启动分区] /mnt/boot","prompt":"#"},"children":[]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"查看先前的挂载方式，有助于你的回忆\n"},{"type":"element","tag":"copy","props":{"code":"cat /mnt/etc/fstab","prompt":"#"},"children":[]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"如果回忆起有其他分区，请继续挂载"}]}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"可以将此时的挂载方式写入原系统：\n"},{"type":"element","tag":"copy","props":{"code":"genfstab -U /mnt > /mnt/etc/fstab","prompt":"#"},"children":[]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"随后就可以进入原系统了\n"},{"type":"element","tag":"copy","props":{"code":"arch-chroot /mnt","prompt":"#"},"children":[]}]}]},{"type":"element","tag":"h2","props":{"id":"修复一些可能导致无法进入的问题"},"children":[{"type":"text","value":"修复一些可能导致无法进入的问题"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"如果忘记 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"root"}]},{"type":"text","value":" 用户密码，可以执行以下命令：\n"},{"type":"element","tag":"copy","props":{"code":"passwd","prompt":"#"},"children":[]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"同时，还可以更新一下系统的软件包，"},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"说不定有用呢"}]},{"type":"text","value":"：\n"},{"type":"element","tag":"copy","props":{"code":"pacman -Syyuu","prompt":"#"},"children":[]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"如果更新缓慢，可以换源"}]}]},{"type":"element","tag":"copy","props":{"code":"pacman -S reflector","prompt":"#"},"children":[]},{"type":"element","tag":"copy","props":{"code":"reflector --verbose --country China --sort rate --save /etc/pacman.d/mirrorlist","prompt":"#"},"children":[]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"如果提醒无法锁定数据库，可以删除锁文件"}]}]},{"type":"element","tag":"copy","props":{"code":"rm /var/lib/pacman/db.lck","prompt":"#"},"children":[]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"如果提醒某文件已存在，可以强制覆盖"}]}]},{"type":"element","tag":"copy","props":{"code":"pacman -Syu --overwrite \"*\"","prompt":"#"},"children":[]}]}]},{"type":"element","tag":"h2","props":{"id":"修复引导"},"children":[{"type":"text","value":"修复引导"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"安装 Linux 包可以触发 mkinitcpio\n"},{"type":"element","tag":"copy","props":{"code":"pacman -S linux","prompt":"#"},"children":[]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"如果使用 systemd-boot，请执行以下命令\n"},{"type":"element","tag":"copy","props":{"code":"bootctl install","prompt":"#"},"children":[]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"使用此命令检测 EFI 引导项和 Boot Loader 配置"}]}]},{"type":"element","tag":"copy","props":{"code":"bootctl list","prompt":"#"},"children":[]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"如果屏幕显示不全，可以使用交互模式，按 q 退出"}]}]},{"type":"element","tag":"copy","props":{"code":"bootctl","prompt":"#"},"children":[]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"如果使用 grub，请执行以下命令\n"},{"type":"element","tag":"copy","props":{"code":"grub-install","prompt":"#"},"children":[]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"备用命令，也可以自行在网上搜索"}]}]},{"type":"element","tag":"copy","props":{"code":"grub-install --target=x86_64-efi --efi-directory=/boot/efi --bootloader-id=grub","prompt":"#"},"children":[]}]}]},{"type":"element","tag":"h2","props":{"id":"为-systemd-boot-添加引导项"},"children":[{"type":"text","value":"为 systemd-boot 添加引导项"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"如果 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"bootctl list"}]},{"type":"text","value":" 显示没有 Arch Linux，那么需要写入以下文件："}]},{"type":"element","tag":"pre","props":{"className":"language-sh shiki shiki-themes catppuccin-latte one-dark-pro","code":"title   Arch Linux (linux)\nlinux   /vmlinuz-linux\ninitrd  /intel-ucode.img\ninitrd  /initramfs-linux.img\noptions root=PARTUUID=692afe0d-e1d7-4e0f-970f-1ed04e0c07e9 zswap.enabled=0 rootflags=subvol=@ rw rootfstype=btrfs\n","filename":"/boot/loader/entries/arch.conf","language":"sh","meta":"","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#1E66F5;--shiki-default-font-style:italic;--shiki-dark:#61AFEF;--shiki-dark-font-style:inherit"},"children":[{"type":"text","value":"title"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#40A02B;--shiki-dark:#98C379"},"children":[{"type":"text","value":"   Arch"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#40A02B;--shiki-dark:#98C379"},"children":[{"type":"text","value":" Linux"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#4C4F69;--shiki-dark:#ABB2BF"},"children":[{"type":"text","value":" (linux)\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#1E66F5;--shiki-default-font-style:italic;--shiki-dark:#61AFEF;--shiki-dark-font-style:inherit"},"children":[{"type":"text","value":"linux"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#40A02B;--shiki-dark:#98C379"},"children":[{"type":"text","value":"   /vmlinuz-linux\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#1E66F5;--shiki-default-font-style:italic;--shiki-dark:#61AFEF;--shiki-dark-font-style:inherit"},"children":[{"type":"text","value":"initrd"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#40A02B;--shiki-dark:#98C379"},"children":[{"type":"text","value":"  /intel-ucode.img\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#1E66F5;--shiki-default-font-style:italic;--shiki-dark:#61AFEF;--shiki-dark-font-style:inherit"},"children":[{"type":"text","value":"initrd"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#40A02B;--shiki-dark:#98C379"},"children":[{"type":"text","value":"  /initramfs-linux.img\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#1E66F5;--shiki-default-font-style:italic;--shiki-dark:#61AFEF;--shiki-dark-font-style:inherit"},"children":[{"type":"text","value":"options"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#40A02B;--shiki-dark:#98C379"},"children":[{"type":"text","value":" root=PARTUUID=692afe0d-e1d7-4e0f-970f-1ed04e0c07e9"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#40A02B;--shiki-dark:#98C379"},"children":[{"type":"text","value":" zswap.enabled="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#FE640B;--shiki-dark:#D19A66"},"children":[{"type":"text","value":"0"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#40A02B;--shiki-dark:#98C379"},"children":[{"type":"text","value":" rootflags=subvol=@"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#40A02B;--shiki-dark:#98C379"},"children":[{"type":"text","value":" rw"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#40A02B;--shiki-dark:#98C379"},"children":[{"type":"text","value":" rootfstype=btrfs\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"请注意："}]},{"type":"element","tag":"ol","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"PARTUUID 和 UUID 不同，"},{"type":"element","tag":"code","props":{"className":"language-sh shiki shiki-themes catppuccin-latte one-dark-pro","language":"sh","style":""},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#1E66F5;--shiki-default-font-style:italic;--shiki-dark:#61AFEF;--shiki-dark-font-style:inherit"},"children":[{"type":"text","value":"lsblk"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#40A02B;--shiki-dark:#D19A66"},"children":[{"type":"text","value":" -f"}]}]},{"type":"text","value":" 命令显示的是 UUID，你可以通过 "},{"type":"element","tag":"code","props":{"className":"language-sh shiki shiki-themes catppuccin-latte one-dark-pro","language":"sh","style":""},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#1E66F5;--shiki-default-font-style:italic;--shiki-dark:#61AFEF;--shiki-dark-font-style:inherit"},"children":[{"type":"text","value":"lsblk"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#40A02B;--shiki-dark:#D19A66"},"children":[{"type":"text","value":" -o+UUID,PARTUUID"}]}]},{"type":"text","value":" 发现两者的区别。\n"},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"查看 PARTUUID 并追加到文件中\n"},{"type":"element","tag":"copy","props":{"code":"blkid -s PARTUUID -o value /dev/[根分区] >> /boot/loader/entries/arch.conf","prompt":"#"},"children":[]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"查看 UUID 并追加到文件中，需要 "},{"type":"element","tag":"code","props":{"className":"language-sh shiki shiki-themes catppuccin-latte one-dark-pro","language":"sh","style":""},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#1E66F5;--shiki-default-font-style:italic;--shiki-dark:#61AFEF;--shiki-dark-font-style:inherit"},"children":[{"type":"text","value":"option"}]}]},{"type":"text","value":" 中使用 "},{"type":"element","tag":"code","props":{"className":"language-sh shiki shiki-themes catppuccin-latte one-dark-pro","language":"sh","style":""},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#4C4F69;--shiki-dark:#E06C75"},"children":[{"type":"text","value":"root"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#179299;--shiki-dark:#56B6C2"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#4C4F69;--shiki-dark:#E06C75"},"children":[{"type":"text","value":"UUID"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#179299;--shiki-dark:#56B6C2"},"children":[{"type":"text","value":"="}]}]},{"type":"element","tag":"copy","props":{"code":"blkid -s UUID -o value /dev/[根分区] >> /boot/loader/entries/arch.conf","prompt":"#"},"children":[]}]}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code","props":{"className":"language-sh shiki shiki-themes catppuccin-latte one-dark-pro","language":"sh","style":""},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#1E66F5;--shiki-default-font-style:italic;--shiki-dark:#61AFEF;--shiki-dark-font-style:inherit"},"children":[{"type":"text","value":"initrd"}]}]},{"type":"text","value":" 中需要添加对应 CPU 的微码，没有的话可以跳过。"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code","props":{"className":"language-sh shiki shiki-themes catppuccin-latte one-dark-pro","language":"sh","style":""},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#1E66F5;--shiki-default-font-style:italic;--shiki-dark:#61AFEF;--shiki-dark-font-style:inherit"},"children":[{"type":"text","value":"options"}]}]},{"type":"text","value":" 中设置合适的 "},{"type":"element","tag":"code","props":{"className":"language-sh shiki shiki-themes catppuccin-latte one-dark-pro","language":"sh","style":""},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#1E66F5;--shiki-default-font-style:italic;--shiki-dark:#61AFEF;--shiki-dark-font-style:inherit"},"children":[{"type":"text","value":"rootfstype"}]}]},{"type":"text","value":" 和 "},{"type":"element","tag":"code","props":{"className":"language-sh shiki shiki-themes catppuccin-latte one-dark-pro","language":"sh","style":""},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#1E66F5;--shiki-default-font-style:italic;--shiki-dark:#61AFEF;--shiki-dark-font-style:inherit"},"children":[{"type":"text","value":"rootflags"}]}]},{"type":"text","value":"，有子卷时需要设置 "},{"type":"element","tag":"code","props":{"className":"language-sh shiki shiki-themes catppuccin-latte one-dark-pro","language":"sh","style":""},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#4C4F69;--shiki-dark:#E06C75"},"children":[{"type":"text","value":"rootflags"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#179299;--shiki-dark:#56B6C2"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#4C4F69;--shiki-dark:#E06C75"},"children":[{"type":"text","value":"subvol"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#179299;--shiki-dark:#56B6C2"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#40A02B;--shiki-dark:#98C379"},"children":[{"type":"text","value":"[子卷名"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#4C4F69;--shiki-dark:#ABB2BF"},"children":[{"type":"text","value":"]"}]}]},{"type":"text","value":"。"}]}]},{"type":"element","tag":"h2","props":{"id":"重启"},"children":[{"type":"text","value":"重启"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"按 Ctrl+Alt+Delete 直接重启。"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"更规范的方式是输入 "},{"type":"element","tag":"code","props":{"className":"language-sh shiki shiki-themes catppuccin-latte one-dark-pro","language":"sh","style":""},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#D20F39;--shiki-default-font-style:italic;--shiki-dark:#56B6C2;--shiki-dark-font-style:inherit"},"children":[{"type":"text","value":"exit"}]}]},{"type":"text","value":" 或按 Ctrl+D 退出 chroot 环境，然后执行 "},{"type":"element","tag":"code","props":{"className":"language-sh shiki shiki-themes catppuccin-latte one-dark-pro","language":"sh","style":""},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#1E66F5;--shiki-default-font-style:italic;--shiki-dark:#61AFEF;--shiki-dark-font-style:inherit"},"children":[{"type":"text","value":"reboot"}]}]},{"type":"text","value":" 命令重启。"}]},{"type":"element","tag":"style","props":{},"children":[{"type":"text","value":"html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html.dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}"}]}],"toc":{"title":"","searchDepth":4,"depth":4,"links":[{"id":"制作启动盘进入并联网","depth":2,"text":"制作启动盘、进入并联网"},{"id":"挂载分区进入系统","depth":2,"text":"挂载分区、进入系统"},{"id":"修复一些可能导致无法进入的问题","depth":2,"text":"修复一些可能导致无法进入的问题"},{"id":"修复引导","depth":2,"text":"修复引导"},{"id":"为-systemd-boot-添加引导项","depth":2,"text":"为 systemd-boot 添加引导项"},{"id":"重启","depth":2,"text":"重启"}]}},"_type":"markdown","_id":"content:posts:2024:archlinux-boot-repair.md","_source":"content","_file":"posts/2024/archlinux-boot-repair.md","_stem":"posts/2024/archlinux-boot-repair","_extension":"md","_original_dir":"/posts"}