{"_path":"/2023/ssh-key-login","_dir":"2023","_draft":false,"_partial":false,"_locale":"","title":"SSH 免密登录","description":"生成SSH密钥，启用公钥认证，将公钥添加至授权列表，实现 Windows/Linux/GitHub SSH 免密登录。","date":"2023-12-25T08:15:00.000Z","updated":"2024-12-26T12:32:04.000Z","image":"https://7.isyangs.cn/24/6664009c87ec5-24.jpg","categories":["经验分享"],"tags":["教程","ssh","远程"],"recommend":true,"readingTime":{"text":"4 min read","minutes":3.06,"time":183600,"words":612},"body":{"type":"root","children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"在终端中使用 SSH 之前，可以先美化终端以提升用户体验。"}]},{"type":"element","tag":"link-banner","props":{"banner":"https://7.isyangs.cn/24/6671b766a4312-24.jpg","description":"一篇优化 Windows Terminal 体验的指南，涵盖 PowerShell 增强、Oh My Posh 主题配置、集成 Git Bash 以及终端美化等方面。","link":"/2024/windows-terminal","title":"Windows 终端体验优化指南"},"children":[]},{"type":"element","tag":"h2","props":{"id":"生成ssh密钥"},"children":[{"type":"text","value":"生成SSH密钥"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"ED225519 类型的密钥综合性能更好。"}]},{"type":"element","tag":"copy","props":{"code":"ssh-keygen -t ed25519"},"children":[]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"连续按回车键即可。如果你想自定义生成内容，请使用 "},{"type":"element","tag":"code","props":{"className":"language-sh shiki shiki-themes catppuccin-latte one-dark-pro","language":"sh","style":""},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#1E66F5;--shiki-default-font-style:italic;--shiki-dark:#61AFEF;--shiki-dark-font-style:inherit"},"children":[{"type":"text","value":"ssh-keygen"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#40A02B;--shiki-dark:#D19A66"},"children":[{"type":"text","value":" -t"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#40A02B;--shiki-dark:#98C379"},"children":[{"type":"text","value":" ed25519"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#40A02B;--shiki-dark:#D19A66"},"children":[{"type":"text","value":" -C"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#40A02B;--shiki-dark:#98C379"},"children":[{"type":"text","value":" \"内容\""}]}]},{"type":"text","value":"。生成好的"},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"公钥"}]},{"type":"text","value":"可以通过 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"cat ~/.ssh/id_ed25519.pub"}]},{"type":"text","value":" 查看。"}]},{"type":"element","tag":"h2","props":{"id":"将公钥加入认证列表"},"children":[{"type":"text","value":"将公钥加入认证列表"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"如果服务端是 Windows OpenSSH，请将服务端 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"%ProgramData%\\ssh\\sshd_config"}]},{"type":"text","value":" 文件中的此行取消注释（需要管理员权限）："}]},{"type":"element","tag":"pre","props":{"className":"language-sh shiki shiki-themes catppuccin-latte one-dark-pro","code":"# PubkeyAuthentication yes\n","filename":"%ProgramData%\\ssh\\sshd_config","language":"sh","meta":"","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#9CA0B0;--shiki-default-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic"},"children":[{"type":"text","value":"# PubkeyAuthentication yes\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"在 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"~/.ssh/authorized_keys"}]},{"type":"text","value":" 文件中逐行添加"},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"公钥"}]},{"type":"text","value":"即可。此文件的权限应当是 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"644"}]},{"type":"text","value":"，否则可能会被拒绝读取（也就是无法用SSH公钥认证登录）。"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"示例："},{"type":"element","tag":"a","props":{"href":"https://gist.github.com/L33Z22L11/fdac255fe90aa9677bf530e7792db703","rel":["nofollow"]},"children":[{"type":"text","value":"我的SSH公钥"}]}]},{"type":"element","tag":"h2","props":{"id":"避免每次输入用户名和ip地址"},"children":[{"type":"text","value":"避免每次输入用户名和IP地址"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"如果你有经常连接的 SSH 服务器，可以在 SSH 配置文件中按照以下格式添加条目，即可直接通过 Host 项的名字连接，还能在 "},{"type":"element","tag":"code","props":{"className":"language-sh shiki shiki-themes catppuccin-latte one-dark-pro","language":"sh","style":""},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#1E66F5;--shiki-default-font-style:italic;--shiki-dark:#61AFEF;--shiki-dark-font-style:inherit"},"children":[{"type":"text","value":"ssh"}]}]},{"type":"text","value":" 命令输到一半时按 Tab 键自动补全："}]},{"type":"element","tag":"pre","props":{"className":"language-ssh-config shiki shiki-themes catppuccin-latte one-dark-pro","code":"Host zhilu-server\n    Hostname 1.1.1.1\n    Port 8022\n    User zhilu\n","filename":"~/.ssh/config","language":"ssh-config","meta":"","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#8839EF;--shiki-dark:#C678DD"},"children":[{"type":"text","value":"Host"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#4C4F69;--shiki-dark:#61AFEF"},"children":[{"type":"text","value":" zhilu-server\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#4C4F69;--shiki-dark:#ABB2BF"},"children":[{"type":"text","value":"    Hostname "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#FE640B;--shiki-dark:#D19A66"},"children":[{"type":"text","value":"1.1.1.1\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#8839EF;--shiki-dark:#C678DD"},"children":[{"type":"text","value":"    Port"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#FE640B;--shiki-dark:#D19A66"},"children":[{"type":"text","value":" 8022\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#8839EF;--shiki-dark:#C678DD"},"children":[{"type":"text","value":"    User"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#4C4F69;--shiki-dark:#ABB2BF"},"children":[{"type":"text","value":" zhilu\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"在 SSH 配置文件中，缩进是一个 Tab 或者 4 个空格。（早期 CMake 的惯用缩进 8 个空格作为规范）"}]},{"type":"element","tag":"h2","props":{"id":"使用公钥完成-github-登录"},"children":[{"type":"text","value":"使用公钥完成 GitHub 登录"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"参见 GitHub 官方教程："},{"type":"element","tag":"a","props":{"href":"https://docs.github.com/zh/authentication/connecting-to-github-with-ssh","rel":["nofollow"]},"children":[{"type":"text","value":"通过 SSH 连接到 GitHub"}]},{"type":"text","value":"。"}]},{"type":"element","tag":"h3","props":{"id":"设置-ssh-代理"},"children":[{"type":"text","value":"设置 SSH 代理"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"通常不建议使用 HTTPS 连接到 GitHub，通过 SSH 连接时一般不需要代理即可直接访问。如果没有使用“TUN 模式”或透明代理，系统代理设置不会自动应用到 SSH 连接上。"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"更改仓库的远程地址\n"},{"type":"element","tag":"copy","props":{"code":"git remote set-url origin git@github.com:username/repo.git"},"children":[]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"当使用代理时，大多数节点"},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"不允许直接访问 22 端口"}]},{"type":"text","value":"，因此应在 443 端口通过 SSH 连接到 GitHub 仓库。可以通过修改 SSH 配置文件实现："}]},{"type":"element","tag":"pre","props":{"className":"language-ssh-config shiki shiki-themes catppuccin-latte one-dark-pro","code":"Host github.com\n    Hostname ssh.github.com\n    Port 443\n    User git\n    # TUN 模式或透明代理不需要 ProxyCommand\n    # Windows下SOCKS5\n    # ProxyCommand connect -S 127.0.0.1:10808 %h %p\n    # Windows下HTTP\n    # ProxyCommand connect -H 127.0.0.1:10809 %h %p\n    # Linux和macOS下SOCKS5\n    # ProxyCommand nc -v -x 127.0.0.1:20170 %h %p\n    # Linux和macOS下HTTP\n    # ProxyCommand nc -v -X connect -x 127.0.0.1:20172 %h %p\n","filename":"~/.ssh/config","language":"ssh-config","meta":"","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#8839EF;--shiki-dark:#C678DD"},"children":[{"type":"text","value":"Host"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#4C4F69;--shiki-dark:#61AFEF"},"children":[{"type":"text","value":" github.com\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#4C4F69;--shiki-dark:#ABB2BF"},"children":[{"type":"text","value":"    Hostname ssh.github.com\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#8839EF;--shiki-dark:#C678DD"},"children":[{"type":"text","value":"    Port"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#FE640B;--shiki-dark:#D19A66"},"children":[{"type":"text","value":" 443\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#8839EF;--shiki-dark:#C678DD"},"children":[{"type":"text","value":"    User"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#4C4F69;--shiki-dark:#ABB2BF"},"children":[{"type":"text","value":" git\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#9CA0B0;--shiki-default-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic"},"children":[{"type":"text","value":"    # TUN 模式或透明代理不需要 ProxyCommand\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#9CA0B0;--shiki-default-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic"},"children":[{"type":"text","value":"    # Windows下SOCKS5\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#9CA0B0;--shiki-default-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic"},"children":[{"type":"text","value":"    # ProxyCommand connect -S 127.0.0.1:10808 %h %p\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#9CA0B0;--shiki-default-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic"},"children":[{"type":"text","value":"    # Windows下HTTP\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":9},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#9CA0B0;--shiki-default-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic"},"children":[{"type":"text","value":"    # ProxyCommand connect -H 127.0.0.1:10809 %h %p\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":10},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#9CA0B0;--shiki-default-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic"},"children":[{"type":"text","value":"    # Linux和macOS下SOCKS5\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":11},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#9CA0B0;--shiki-default-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic"},"children":[{"type":"text","value":"    # ProxyCommand nc -v -x 127.0.0.1:20170 %h %p\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":12},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#9CA0B0;--shiki-default-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic"},"children":[{"type":"text","value":"    # Linux和macOS下HTTP\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":13},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#9CA0B0;--shiki-default-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic"},"children":[{"type":"text","value":"    # ProxyCommand nc -v -X connect -x 127.0.0.1:20172 %h %p\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"这样一般能正常执行 git 操作，如果不行，可以通过启用或取消注释来通过代理访问 GitHub，端口可能需要更改。"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Linux 和 macOS：可以使用 "},{"type":"element","tag":"code","props":{"className":"language-sh shiki shiki-themes catppuccin-latte one-dark-pro","language":"sh","style":""},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#1E66F5;--shiki-default-font-style:italic;--shiki-dark:#61AFEF;--shiki-dark-font-style:inherit"},"children":[{"type":"text","value":"nc"}]}]},{"type":"text","value":" 工具来实现 SOCKS5 代理。"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Windows：需要用 "},{"type":"element","tag":"code","props":{"className":"language-sh shiki shiki-themes catppuccin-latte one-dark-pro","language":"sh","style":""},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#1E66F5;--shiki-default-font-style:italic;--shiki-dark:#61AFEF;--shiki-dark-font-style:inherit"},"children":[{"type":"text","value":"connect"}]}]},{"type":"text","value":" 命令，该命令可在 Git for Windows 提供的 Git Bash 中找到，如果无法执行 connect，可能需要使用 Git Bash 操作。"}]}]},{"type":"element","tag":"h2","props":{"id":"关于-ssh-的更多玩法"},"children":[{"type":"text","value":"关于 SSH 的更多玩法"}]},{"type":"element","tag":"link-card","props":{"icon":"https://cdn.yuuu.org/img/favicon-192x192.png","link":"https://yuuu.org/post/64202.html","title":"ssh 知识整理 | 微霞"},"children":[]},{"type":"element","tag":"style","props":{},"children":[{"type":"text","value":"html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html.dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}"}]}],"toc":{"title":"","searchDepth":4,"depth":4,"links":[{"id":"生成ssh密钥","depth":2,"text":"生成SSH密钥"},{"id":"将公钥加入认证列表","depth":2,"text":"将公钥加入认证列表"},{"id":"避免每次输入用户名和ip地址","depth":2,"text":"避免每次输入用户名和IP地址"},{"id":"使用公钥完成-github-登录","depth":2,"text":"使用公钥完成 GitHub 登录","children":[{"id":"设置-ssh-代理","depth":3,"text":"设置 SSH 代理"}]},{"id":"关于-ssh-的更多玩法","depth":2,"text":"关于 SSH 的更多玩法"}]}},"_type":"markdown","_id":"content:posts:2023:ssh-key-login.md","_source":"content","_file":"posts/2023/ssh-key-login.md","_stem":"posts/2023/ssh-key-login","_extension":"md","_original_dir":"/posts"}