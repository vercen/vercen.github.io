var _e=Object.defineProperty;var ve=(n,t,e)=>t in n?_e(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e;var _=(n,t,e)=>ve(n,typeof t!="symbol"?t+"":t,e);import{t as Le,F as v,I as U,R as Ce,T as xe,E as re}from"./DGBHXtJB.js";import"./CiDwHVmI.js";let T=class extends Error{constructor(t){super(t),this.name="ShikiError"}};function P(n,t){const e=typeof n=="string"?{}:{...n.colorReplacements},r=typeof n=="string"?n:n.name;for(const[s,o]of Object.entries((t==null?void 0:t.colorReplacements)||{}))typeof o=="string"?e[s]=o:s===r&&Object.assign(e,o);return e}function N(n,t){return n&&((t==null?void 0:t[n==null?void 0:n.toLowerCase()])||n)}function $e(n){return Array.isArray(n)?n:[n]}async function le(n){return Promise.resolve(typeof n=="function"?n():n).then(t=>t.default||t)}function Q(n){return!n||["plaintext","txt","text","plain"].includes(n)}function fe(n){return n==="ansi"||Q(n)}function X(n){return n==="none"}function ue(n){return X(n)}function ge(n,t){var r;if(!t)return n;n.properties||(n.properties={}),(r=n.properties).class||(r.class=[]),typeof n.properties.class=="string"&&(n.properties.class=n.properties.class.split(/\s+/g)),Array.isArray(n.properties.class)||(n.properties.class=[]);const e=Array.isArray(t)?t:t.split(/\s+/g);for(const s of e)s&&!n.properties.class.includes(s)&&n.properties.class.push(s);return n}function z(n,t=!1){var o;const e=n.split(/(\r?\n)/g);let r=0;const s=[];for(let a=0;a<e.length;a+=2){const i=t?e[a]+(e[a+1]||""):e[a];s.push([i,r]),r+=e[a].length,r+=((o=e[a+1])==null?void 0:o.length)||0}return s}function Ne(n){const t=z(n,!0).map(([s])=>s);function e(s){if(s===n.length)return{line:t.length-1,character:t[t.length-1].length};let o=s,a=0;for(const i of t){if(o<i.length)break;o-=i.length,a++}return{line:a,character:o}}function r(s,o){let a=0;for(let i=0;i<s;i++)a+=t[i].length;return a+=o,a}return{lines:t,indexToPos:e,posToIndex:r}}function gt(n,t,e){const r=new Set;for(const o of n.matchAll(/lang=["']([\w-]+)["']/g))r.add(o[1]);for(const o of n.matchAll(/(?:```|~~~)([\w-]+)/g))r.add(o[1]);for(const o of n.matchAll(/\\begin\{([\w-]+)\}/g))r.add(o[1]);if(!e)return Array.from(r);const s=e.getBundledLanguages();return Array.from(r).filter(o=>o&&s[o])}function Ee(n,t){let e=0;const r=[];for(const s of t)s>e&&r.push({...n,content:n.content.slice(e,s),offset:n.offset+e}),e=s;return e<n.content.length&&r.push({...n,content:n.content.slice(e),offset:n.offset+e}),r}function Ie(n,t){const e=Array.from(t instanceof Set?t:new Set(t)).sort((r,s)=>r-s);return e.length?n.map(r=>r.flatMap(s=>{const o=e.filter(a=>s.offset<a&&a<s.offset+s.content.length).map(a=>a-s.offset).sort((a,i)=>a-i);return o.length?Ee(s,o):s})):n}function Be(n,t,e,r){const s={content:n.content,explanation:n.explanation,offset:n.offset},o=t.map(c=>he(n.variants[c])),a=new Set(o.flatMap(c=>Object.keys(c))),i={};return o.forEach((c,l)=>{for(const g of a){const f=c[g]||"inherit";if(l===0&&r)i[g]=f;else{const u=g==="color"?"":g==="background-color"?"-bg":`-${g}`,m=e+t[l]+(g==="color"?"":u);i[m]=f}}}),s.htmlStyle=i,s}function he(n){const t={};if(n.color&&(t.color=n.color),n.bgColor&&(t["background-color"]=n.bgColor),n.fontStyle){n.fontStyle&v.Italic&&(t["font-style"]="italic"),n.fontStyle&v.Bold&&(t["font-weight"]="bold");const e=[];n.fontStyle&v.Underline&&e.push("underline"),n.fontStyle&v.Strikethrough&&e.push("line-through"),e.length&&(t["text-decoration"]=e.join(" "))}return t}function je(n){return typeof n=="string"?n:Object.entries(n).map(([t,e])=>`${t}:${e}`).join(";")}const de=new WeakMap;function J(n,t){de.set(n,t)}function A(n){return de.get(n)}class j{constructor(...t){_(this,"_stacks",{});_(this,"lang");if(t.length===2){const[e,r]=t;this.lang=r,this._stacks=e}else{const[e,r,s]=t;this.lang=r,this._stacks={[s]:e}}}get themes(){return Object.keys(this._stacks)}get theme(){return this.themes[0]}get _stack(){return this._stacks[this.theme]}static initial(t,e){return new j(Object.fromEntries($e(e).map(r=>[r,U])),t)}getInternalStack(t=this.theme){return this._stacks[t]}getScopes(t=this.theme){return Me(this._stacks[t])}toJSON(){return{lang:this.lang,theme:this.theme,themes:this.themes,scopes:this.getScopes()}}}function Me(n){const t=[],e=new Set;function r(s){var a;if(e.has(s))return;e.add(s);const o=(a=s==null?void 0:s.nameScopesList)==null?void 0:a.scopeName;o&&t.push(o),s.parent&&r(s.parent)}return r(n),t}function Oe(n,t){if(!(n instanceof j))throw new T("Invalid grammar state");return n.getInternalStack(t)}function Ae(){const n=new WeakMap;function t(e){if(!n.has(e.meta)){let r=function(a){if(typeof a=="number"){if(a<0||a>e.source.length)throw new T(`Invalid decoration offset: ${a}. Code length: ${e.source.length}`);return{...s.indexToPos(a),offset:a}}else{const i=s.lines[a.line];if(i===void 0)throw new T(`Invalid decoration position ${JSON.stringify(a)}. Lines length: ${s.lines.length}`);if(a.character<0||a.character>i.length)throw new T(`Invalid decoration position ${JSON.stringify(a)}. Line ${a.line} length: ${i.length}`);return{...a,offset:s.posToIndex(a.line,a.character)}}};const s=Ne(e.source),o=(e.options.decorations||[]).map(a=>({...a,start:r(a.start),end:r(a.end)}));Ge(o),n.set(e.meta,{decorations:o,converter:s,source:e.source})}return n.get(e.meta)}return{name:"shiki:decorations",tokens(e){var a;if(!((a=this.options.decorations)!=null&&a.length))return;const s=t(this).decorations.flatMap(i=>[i.start.offset,i.end.offset]);return Ie(e,s)},code(e){var g;if(!((g=this.options.decorations)!=null&&g.length))return;const r=t(this),s=Array.from(e.children).filter(f=>f.type==="element"&&f.tagName==="span");if(s.length!==r.converter.lines.length)throw new T(`Number of lines in code element (${s.length}) does not match the number of lines in the source (${r.converter.lines.length}). Failed to apply decorations.`);function o(f,u,m,y){const k=s[f];let h="",d=-1,p=-1;if(u===0&&(d=0),m===0&&(p=0),m===Number.POSITIVE_INFINITY&&(p=k.children.length),d===-1||p===-1)for(let w=0;w<k.children.length;w++)h+=me(k.children[w]),d===-1&&h.length===u&&(d=w+1),p===-1&&h.length===m&&(p=w+1);if(d===-1)throw new T(`Failed to find start index for decoration ${JSON.stringify(y.start)}`);if(p===-1)throw new T(`Failed to find end index for decoration ${JSON.stringify(y.end)}`);const b=k.children.slice(d,p);if(!y.alwaysWrap&&b.length===k.children.length)i(k,y,"line");else if(!y.alwaysWrap&&b.length===1&&b[0].type==="element")i(b[0],y,"token");else{const w={type:"element",tagName:"span",properties:{},children:b};i(w,y,"wrapper"),k.children.splice(d,b.length,w)}}function a(f,u){s[f]=i(s[f],u,"line")}function i(f,u,m){var h;const y=u.properties||{},k=u.transform||(d=>d);return f.tagName=u.tagName||"span",f.properties={...f.properties,...y,class:f.properties.class},(h=u.properties)!=null&&h.class&&ge(f,u.properties.class),f=k(f,m)||f,f}const c=[],l=r.decorations.sort((f,u)=>u.start.offset-f.start.offset||f.end.offset-u.end.offset);for(const f of l){const{start:u,end:m}=f;if(u.line===m.line)o(u.line,u.character,m.character,f);else if(u.line<m.line){o(u.line,u.character,Number.POSITIVE_INFINITY,f);for(let y=u.line+1;y<m.line;y++)c.unshift(()=>a(y,f));o(m.line,0,m.character,f)}}c.forEach(f=>f())}}}function Ge(n){for(let t=0;t<n.length;t++){const e=n[t];if(e.start.offset>e.end.offset)throw new T(`Invalid decoration range: ${JSON.stringify(e.start)} - ${JSON.stringify(e.end)}`);for(let r=t+1;r<n.length;r++){const s=n[r],o=e.start.offset<=s.start.offset&&s.start.offset<e.end.offset,a=e.start.offset<s.end.offset&&s.end.offset<=e.end.offset,i=s.start.offset<=e.start.offset&&e.start.offset<s.end.offset,c=s.start.offset<e.end.offset&&e.end.offset<=s.end.offset;if(o||a||i||c){if(o&&a||i&&c)continue;throw new T(`Decorations ${JSON.stringify(e.start)} and ${JSON.stringify(s.start)} intersect.`)}}}}function me(n){return n.type==="text"?n.value:n.type==="element"?n.children.map(me).join(""):""}const Re=[Ae()];function D(n){return[...n.transformers||[],...Re]}var E=["black","red","green","yellow","blue","magenta","cyan","white","brightBlack","brightRed","brightGreen","brightYellow","brightBlue","brightMagenta","brightCyan","brightWhite"],K={1:"bold",2:"dim",3:"italic",4:"underline",7:"reverse",8:"hidden",9:"strikethrough"};function He(n,t){const e=n.indexOf("\x1B",t);if(e!==-1&&n[e+1]==="["){const r=n.indexOf("m",e);if(r!==-1)return{sequence:n.substring(e+2,r).split(";"),startPosition:e,position:r+1}}return{position:n.length}}function se(n){const t=n.shift();if(t==="2"){const e=n.splice(0,3).map(r=>Number.parseInt(r));return e.length!==3||e.some(r=>Number.isNaN(r))?void 0:{type:"rgb",rgb:e}}else if(t==="5"){const e=n.shift();if(e)return{type:"table",index:Number(e)}}}function We(n){const t=[];for(;n.length>0;){const e=n.shift();if(!e)continue;const r=Number.parseInt(e);if(!Number.isNaN(r))if(r===0)t.push({type:"resetAll"});else if(r<=9)K[r]&&t.push({type:"setDecoration",value:K[r]});else if(r<=29){const s=K[r-20];s&&(t.push({type:"resetDecoration",value:s}),s==="dim"&&t.push({type:"resetDecoration",value:"bold"}))}else if(r<=37)t.push({type:"setForegroundColor",value:{type:"named",name:E[r-30]}});else if(r===38){const s=se(n);s&&t.push({type:"setForegroundColor",value:s})}else if(r===39)t.push({type:"resetForegroundColor"});else if(r<=47)t.push({type:"setBackgroundColor",value:{type:"named",name:E[r-40]}});else if(r===48){const s=se(n);s&&t.push({type:"setBackgroundColor",value:s})}else r===49?t.push({type:"resetBackgroundColor"}):r===53?t.push({type:"setDecoration",value:"overline"}):r===55?t.push({type:"resetDecoration",value:"overline"}):r>=90&&r<=97?t.push({type:"setForegroundColor",value:{type:"named",name:E[r-90+8]}}):r>=100&&r<=107&&t.push({type:"setBackgroundColor",value:{type:"named",name:E[r-100+8]}})}return t}function Pe(){let n=null,t=null,e=new Set;return{parse(r){const s=[];let o=0;do{const a=He(r,o),i=a.sequence?r.substring(o,a.startPosition):r.substring(o);if(i.length>0&&s.push({value:i,foreground:n,background:t,decorations:new Set(e)}),a.sequence){const c=We(a.sequence);for(const l of c)l.type==="resetAll"?(n=null,t=null,e.clear()):l.type==="resetForegroundColor"?n=null:l.type==="resetBackgroundColor"?t=null:l.type==="resetDecoration"&&e.delete(l.value);for(const l of c)l.type==="setForegroundColor"?n=l.value:l.type==="setBackgroundColor"?t=l.value:l.type==="setDecoration"&&e.add(l.value)}o=a.position}while(o<r.length);return s}}}var De={black:"#000000",red:"#bb0000",green:"#00bb00",yellow:"#bbbb00",blue:"#0000bb",magenta:"#ff00ff",cyan:"#00bbbb",white:"#eeeeee",brightBlack:"#555555",brightRed:"#ff5555",brightGreen:"#00ff00",brightYellow:"#ffff55",brightBlue:"#5555ff",brightMagenta:"#ff55ff",brightCyan:"#55ffff",brightWhite:"#ffffff"};function Fe(n=De){function t(i){return n[i]}function e(i){return`#${i.map(c=>Math.max(0,Math.min(c,255)).toString(16).padStart(2,"0")).join("")}`}let r;function s(){if(r)return r;r=[];for(let l=0;l<E.length;l++)r.push(t(E[l]));let i=[0,95,135,175,215,255];for(let l=0;l<6;l++)for(let g=0;g<6;g++)for(let f=0;f<6;f++)r.push(e([i[l],i[g],i[f]]));let c=8;for(let l=0;l<24;l++,c+=10)r.push(e([c,c,c]));return r}function o(i){return s()[i]}function a(i){switch(i.type){case"named":return t(i.name);case"rgb":return e(i.rgb);case"table":return o(i.index)}}return{value:a}}function ze(n,t,e){const r=P(n,e),s=z(t),o=Fe(Object.fromEntries(E.map(i=>{var c;return[i,(c=n.colors)==null?void 0:c[`terminal.ansi${i[0].toUpperCase()}${i.substring(1)}`]]}))),a=Pe();return s.map(i=>a.parse(i[0]).map(c=>{let l,g;c.decorations.has("reverse")?(l=c.background?o.value(c.background):n.bg,g=c.foreground?o.value(c.foreground):n.fg):(l=c.foreground?o.value(c.foreground):n.fg,g=c.background?o.value(c.background):void 0),l=N(l,r),g=N(g,r),c.decorations.has("dim")&&(l=Je(l));let f=v.None;return c.decorations.has("bold")&&(f|=v.Bold),c.decorations.has("italic")&&(f|=v.Italic),c.decorations.has("underline")&&(f|=v.Underline),c.decorations.has("strikethrough")&&(f|=v.Strikethrough),{content:c.value,offset:i[1],color:l,bgColor:g,fontStyle:f}}))}function Je(n){const t=n.match(/#([0-9a-f]{3})([0-9a-f]{3})?([0-9a-f]{2})?/);if(t)if(t[3]){const r=Math.round(Number.parseInt(t[3],16)/2).toString(16).padStart(2,"0");return`#${t[1]}${t[2]}${r}`}else return t[2]?`#${t[1]}${t[2]}80`:`#${Array.from(t[1]).map(r=>`${r}${r}`).join("")}80`;const e=n.match(/var\((--[\w-]+-ansi-[\w-]+)\)/);return e?`var(${e[1]}-dim)`:n}function V(n,t,e={}){const{lang:r="text",theme:s=n.getLoadedThemes()[0]}=e;if(Q(r)||X(s))return z(t).map(c=>[{content:c[0],offset:c[1]}]);const{theme:o,colorMap:a}=n.setTheme(s);if(r==="ansi")return ze(o,t,e);const i=n.getLanguage(r);if(e.grammarState){if(e.grammarState.lang!==i.name)throw new T(`Grammar state language "${e.grammarState.lang}" does not match highlight language "${i.name}"`);if(!e.grammarState.themes.includes(o.name))throw new T(`Grammar state themes "${e.grammarState.themes}" do not contain highlight theme "${o.name}"`)}return Ve(t,i,o,a,e)}function pe(...n){if(n.length===2)return A(n[1]);const[t,e,r={}]=n,{lang:s="text",theme:o=t.getLoadedThemes()[0]}=r;if(Q(s)||X(o))throw new T("Plain language does not have grammar state");if(s==="ansi")throw new T("ANSI language does not have grammar state");const{theme:a,colorMap:i}=t.setTheme(o),c=t.getLanguage(s);return new j(F(e,c,a,i,r).stateStack,c.name,a.name)}function Ve(n,t,e,r,s){const o=F(n,t,e,r,s),a=new j(F(n,t,e,r,s).stateStack,t.name,e.name);return J(o.tokens,a),o.tokens}function F(n,t,e,r,s){const o=P(e,s),{tokenizeMaxLineLength:a=0,tokenizeTimeLimit:i=500}=s,c=z(n);let l=s.grammarState?Oe(s.grammarState,e.name)??U:s.grammarContextCode!=null?F(s.grammarContextCode,t,e,r,{...s,grammarState:void 0,grammarContextCode:void 0}).stateStack:U,g=[];const f=[];for(let u=0,m=c.length;u<m;u++){const[y,k]=c[u];if(y===""){g=[],f.push([]);continue}if(a>0&&y.length>=a){g=[],f.push([{content:y,offset:k,color:"",fontStyle:0}]);continue}let h,d,p;s.includeExplanation&&(h=t.tokenizeLine(y,l,i),d=h.tokens,p=0);const b=t.tokenizeLine2(y,l,i),w=b.tokens.length/2;for(let L=0;L<w;L++){const $=b.tokens[2*L],S=L+1<w?b.tokens[2*L+2]:y.length;if($===S)continue;const C=b.tokens[2*L+1],H=N(r[re.getForeground(C)],o),M=re.getFontStyle(C),Y={content:y.substring($,S),offset:k+$,color:H,fontStyle:M};if(s.includeExplanation){const te=[];if(s.includeExplanation!=="scopeName")for(const x of e.settings){let I;switch(typeof x.scope){case"string":I=x.scope.split(/,/).map(q=>q.trim());break;case"object":I=x.scope;break;default:continue}te.push({settings:x,selectors:I.map(q=>q.split(/ /))})}Y.explanation=[];let ne=0;for(;$+ne<S;){const x=d[p],I=y.substring(x.startIndex,x.endIndex);ne+=I.length,Y.explanation.push({content:I,scopes:s.includeExplanation==="scopeName"?Ye(x.scopes):qe(te,x.scopes)}),p+=1}}g.push(Y)}f.push(g),g=[],l=b.ruleStack}return{tokens:f,stateStack:l}}function Ye(n){return n.map(t=>({scopeName:t}))}function qe(n,t){const e=[];for(let r=0,s=t.length;r<s;r++){const o=t[r];e[r]={scopeName:o,themeMatches:Ue(n,o,t.slice(0,r))}}return e}function oe(n,t){return n===t||t.substring(0,n.length)===n&&t[n.length]==="."}function Ke(n,t,e){if(!oe(n[n.length-1],t))return!1;let r=n.length-2,s=e.length-1;for(;r>=0&&s>=0;)oe(n[r],e[s])&&(r-=1),s-=1;return r===-1}function Ue(n,t,e){const r=[];for(const{selectors:s,settings:o}of n)for(const a of s)if(Ke(a,t,e)){r.push(o);break}return r}function Z(n,t,e){const r=Object.entries(e.themes).filter(c=>c[1]).map(c=>({color:c[0],theme:c[1]})),s=r.map(c=>{const l=V(n,t,{...e,theme:c.theme}),g=A(l),f=typeof c.theme=="string"?c.theme:c.theme.name;return{tokens:l,state:g,theme:f}}),o=Qe(...s.map(c=>c.tokens)),a=o[0].map((c,l)=>c.map((g,f)=>{const u={content:g.content,variants:{},offset:g.offset};return"includeExplanation"in e&&e.includeExplanation&&(u.explanation=g.explanation),o.forEach((m,y)=>{const{content:k,explanation:h,offset:d,...p}=m[l][f];u.variants[r[y].color]=p}),u})),i=s[0].state?new j(Object.fromEntries(s.map(c=>{var l;return[c.theme,(l=c.state)==null?void 0:l.getInternalStack(c.theme)]})),s[0].state.lang):void 0;return i&&J(a,i),a}function Qe(...n){const t=n.map(()=>[]),e=n.length;for(let r=0;r<n[0].length;r++){const s=n.map(c=>c[r]),o=t.map(()=>[]);t.forEach((c,l)=>c.push(o[l]));const a=s.map(()=>0),i=s.map(c=>c[0]);for(;i.every(c=>c);){const c=Math.min(...i.map(l=>l.content.length));for(let l=0;l<e;l++){const g=i[l];g.content.length===c?(o[l].push(g),a[l]+=1,i[l]=s[l][a[l]]):(o[l].push({...g,content:g.content.slice(0,c)}),i[l]={...g,content:g.content.slice(c),offset:g.offset+c})}}}return t}function G(n,t,e){let r,s,o,a,i,c;if("themes"in e){const{defaultColor:l="light",cssVariablePrefix:g="--shiki-"}=e,f=Object.entries(e.themes).filter(h=>h[1]).map(h=>({color:h[0],theme:h[1]})).sort((h,d)=>h.color===l?-1:d.color===l?1:0);if(f.length===0)throw new T("`themes` option must not be empty");const u=Z(n,t,e);if(c=A(u),l&&!f.find(h=>h.color===l))throw new T(`\`themes\` option must contain the defaultColor key \`${l}\``);const m=f.map(h=>n.getTheme(h.theme)),y=f.map(h=>h.color);o=u.map(h=>h.map(d=>Be(d,y,g,l))),c&&J(o,c);const k=f.map(h=>P(h.theme,e));s=f.map((h,d)=>(d===0&&l?"":`${g+h.color}:`)+(N(m[d].fg,k[d])||"inherit")).join(";"),r=f.map((h,d)=>(d===0&&l?"":`${g+h.color}-bg:`)+(N(m[d].bg,k[d])||"inherit")).join(";"),a=`shiki-themes ${m.map(h=>h.name).join(" ")}`,i=l?void 0:[s,r].join(";")}else if("theme"in e){const l=P(e.theme,e);o=V(n,t,e);const g=n.getTheme(e.theme);r=N(g.bg,l),s=N(g.fg,l),a=g.name,c=A(o)}else throw new T("Invalid options, either `theme` or `themes` must be provided");return{tokens:o,fg:s,bg:r,themeName:a,rootStyle:i,grammarState:c}}function R(n,t,e,r={meta:{},options:e,codeToHast:(s,o)=>R(n,s,o),codeToTokens:(s,o)=>G(n,s,o)}){var m,y;let s=t;for(const k of D(e))s=((m=k.preprocess)==null?void 0:m.call(r,s,e))||s;let{tokens:o,fg:a,bg:i,themeName:c,rootStyle:l,grammarState:g}=G(n,s,e);const{mergeWhitespaces:f=!0}=e;f===!0?o=Ze(o):f==="never"&&(o=et(o));const u={...r,get source(){return s}};for(const k of D(e))o=((y=k.tokens)==null?void 0:y.call(u,o))||o;return Xe(o,{...e,fg:a,bg:i,themeName:c,rootStyle:l},u,g)}function Xe(n,t,e,r=A(n)){var y,k,h;const s=D(t),o=[],a={type:"root",children:[]},{structure:i="classic",tabindex:c="0"}=t;let l={type:"element",tagName:"pre",properties:{class:`shiki ${t.themeName||""}`,style:t.rootStyle||`background-color:${t.bg};color:${t.fg}`,...c!==!1&&c!=null?{tabindex:c.toString()}:{},...Object.fromEntries(Array.from(Object.entries(t.meta||{})).filter(([d])=>!d.startsWith("_")))},children:[]},g={type:"element",tagName:"code",properties:{},children:o};const f=[],u={...e,structure:i,addClassToHast:ge,get source(){return e.source},get tokens(){return n},get options(){return t},get root(){return a},get pre(){return l},get code(){return g},get lines(){return f}};if(n.forEach((d,p)=>{var L,$;p&&(i==="inline"?a.children.push({type:"element",tagName:"br",properties:{},children:[]}):i==="classic"&&o.push({type:"text",value:`
`}));let b={type:"element",tagName:"span",properties:{class:"line"},children:[]},w=0;for(const S of d){let C={type:"element",tagName:"span",properties:{...S.htmlAttrs},children:[{type:"text",value:S.content}]};const H=je(S.htmlStyle||he(S));H&&(C.properties.style=H);for(const M of s)C=((L=M==null?void 0:M.span)==null?void 0:L.call(u,C,p+1,w,b,S))||C;i==="inline"?a.children.push(C):i==="classic"&&b.children.push(C),w+=S.content.length}if(i==="classic"){for(const S of s)b=(($=S==null?void 0:S.line)==null?void 0:$.call(u,b,p+1))||b;f.push(b),o.push(b)}}),i==="classic"){for(const d of s)g=((y=d==null?void 0:d.code)==null?void 0:y.call(u,g))||g;l.children.push(g);for(const d of s)l=((k=d==null?void 0:d.pre)==null?void 0:k.call(u,l))||l;a.children.push(l)}let m=a;for(const d of s)m=((h=d==null?void 0:d.root)==null?void 0:h.call(u,m))||m;return r&&J(m,r),m}function Ze(n){return n.map(t=>{const e=[];let r="",s=0;return t.forEach((o,a)=>{const c=!(o.fontStyle&&(o.fontStyle&v.Underline||o.fontStyle&v.Strikethrough));c&&o.content.match(/^\s+$/)&&t[a+1]?(s||(s=o.offset),r+=o.content):r?(c?e.push({...o,offset:s,content:r+o.content}):e.push({content:r,offset:s},o),s=0,r=""):e.push(o)}),e})}function et(n){return n.map(t=>t.flatMap(e=>{if(e.content.match(/^\s+$/))return e;const r=e.content.match(/^(\s*)(.*?)(\s*)$/);if(!r)return e;const[,s,o,a]=r;if(!s&&!a)return e;const i=[{...e,offset:e.offset+s.length,content:o}];return s&&i.unshift({content:s,offset:e.offset}),a&&i.push({content:a,offset:e.offset+s.length+o.length}),i}))}const tt=Le;function ye(n,t,e){var o;const r={meta:{},options:e,codeToHast:(a,i)=>R(n,a,i),codeToTokens:(a,i)=>G(n,a,i)};let s=tt(R(n,t,e,r));for(const a of D(e))s=((o=a.postprocess)==null?void 0:o.call(r,s,e))||s;return s}const ae={light:"#333333",dark:"#bbbbbb"},ie={light:"#fffffe",dark:"#1e1e1e"},ce="__shiki_resolved";function ee(n){var i,c,l,g,f;if(n!=null&&n[ce])return n;const t={...n};t.tokenColors&&!t.settings&&(t.settings=t.tokenColors,delete t.tokenColors),t.type||(t.type="dark"),t.colorReplacements={...t.colorReplacements},t.settings||(t.settings=[]);let{bg:e,fg:r}=t;if(!e||!r){const u=t.settings?t.settings.find(m=>!m.name&&!m.scope):void 0;(i=u==null?void 0:u.settings)!=null&&i.foreground&&(r=u.settings.foreground),(c=u==null?void 0:u.settings)!=null&&c.background&&(e=u.settings.background),!r&&((l=t==null?void 0:t.colors)!=null&&l["editor.foreground"])&&(r=t.colors["editor.foreground"]),!e&&((g=t==null?void 0:t.colors)!=null&&g["editor.background"])&&(e=t.colors["editor.background"]),r||(r=t.type==="light"?ae.light:ae.dark),e||(e=t.type==="light"?ie.light:ie.dark),t.fg=r,t.bg=e}t.settings[0]&&t.settings[0].settings&&!t.settings[0].scope||t.settings.unshift({settings:{foreground:t.fg,background:t.bg}});let s=0;const o=new Map;function a(u){var y;if(o.has(u))return o.get(u);s+=1;const m=`#${s.toString(16).padStart(8,"0").toLowerCase()}`;return(y=t.colorReplacements)!=null&&y[`#${m}`]?a(u):(o.set(u,m),m)}t.settings=t.settings.map(u=>{var h,d;const m=((h=u.settings)==null?void 0:h.foreground)&&!u.settings.foreground.startsWith("#"),y=((d=u.settings)==null?void 0:d.background)&&!u.settings.background.startsWith("#");if(!m&&!y)return u;const k={...u,settings:{...u.settings}};if(m){const p=a(u.settings.foreground);t.colorReplacements[p]=u.settings.foreground,k.settings.foreground=p}if(y){const p=a(u.settings.background);t.colorReplacements[p]=u.settings.background,k.settings.background=p}return k});for(const u of Object.keys(t.colors||{}))if((u==="editor.foreground"||u==="editor.background"||u.startsWith("terminal.ansi"))&&!((f=t.colors[u])!=null&&f.startsWith("#"))){const m=a(t.colors[u]);t.colorReplacements[m]=t.colors[u],t.colors[u]=m}return Object.defineProperty(t,ce,{enumerable:!1,writable:!1,value:!0}),t}async function be(n){return Array.from(new Set((await Promise.all(n.filter(t=>!fe(t)).map(async t=>await le(t).then(e=>Array.isArray(e)?e:[e])))).flat()))}async function ke(n){return(await Promise.all(n.map(async e=>ue(e)?null:ee(await le(e))))).filter(e=>!!e)}let W=3,Te=!1;function ht(n=!0,t=!1){W=n,Te=t}function nt(n,t=3){if(W&&!(typeof W=="number"&&t>W)){if(Te)throw new Error(`[SHIKI DEPRECATE]: ${n}`);console.trace(`[SHIKI DEPRECATE]: ${n}`)}}class B extends Error{constructor(t){super(t),this.name="ShikiError"}}class rt extends Ce{constructor(e,r,s,o={}){super(e);_(this,"_resolvedThemes",new Map);_(this,"_resolvedGrammars",new Map);_(this,"_langMap",new Map);_(this,"_langGraph",new Map);_(this,"_textmateThemeCache",new WeakMap);_(this,"_loadedThemesCache",null);_(this,"_loadedLanguagesCache",null);this._resolver=e,this._themes=r,this._langs=s,this._alias=o,this._themes.map(a=>this.loadTheme(a)),this.loadLanguages(this._langs)}getTheme(e){return typeof e=="string"?this._resolvedThemes.get(e):this.loadTheme(e)}loadTheme(e){const r=ee(e);return r.name&&(this._resolvedThemes.set(r.name,r),this._loadedThemesCache=null),r}getLoadedThemes(){return this._loadedThemesCache||(this._loadedThemesCache=[...this._resolvedThemes.keys()]),this._loadedThemesCache}setTheme(e){let r=this._textmateThemeCache.get(e);r||(r=xe.createFromRawTheme(e),this._textmateThemeCache.set(e,r)),this._syncRegistry.setTheme(r)}getGrammar(e){if(this._alias[e]){const r=new Set([e]);for(;this._alias[e];){if(e=this._alias[e],r.has(e))throw new B(`Circular alias \`${Array.from(r).join(" -> ")} -> ${e}\``);r.add(e)}}return this._resolvedGrammars.get(e)}loadLanguage(e){var a,i,c,l;if(this.getGrammar(e.name))return;const r=new Set([...this._langMap.values()].filter(g=>{var f;return(f=g.embeddedLangsLazy)==null?void 0:f.includes(e.name)}));this._resolver.addLanguage(e);const s={balancedBracketSelectors:e.balancedBracketSelectors||["*"],unbalancedBracketSelectors:e.unbalancedBracketSelectors||[]};this._syncRegistry._rawGrammars.set(e.scopeName,e);const o=this.loadGrammarWithConfiguration(e.scopeName,1,s);if(o.name=e.name,this._resolvedGrammars.set(e.name,o),e.aliases&&e.aliases.forEach(g=>{this._alias[g]=e.name}),this._loadedLanguagesCache=null,r.size)for(const g of r)this._resolvedGrammars.delete(g.name),this._loadedLanguagesCache=null,(i=(a=this._syncRegistry)==null?void 0:a._injectionGrammars)==null||i.delete(g.scopeName),(l=(c=this._syncRegistry)==null?void 0:c._grammars)==null||l.delete(g.scopeName),this.loadLanguage(this._langMap.get(g.name))}dispose(){super.dispose(),this._resolvedThemes.clear(),this._resolvedGrammars.clear(),this._langMap.clear(),this._langGraph.clear(),this._loadedThemesCache=null}loadLanguages(e){for(const o of e)this.resolveEmbeddedLanguages(o);const r=Array.from(this._langGraph.entries()),s=r.filter(([o,a])=>!a);if(s.length){const o=r.filter(([a,i])=>{var c;return i&&((c=i.embeddedLangs)==null?void 0:c.some(l=>s.map(([g])=>g).includes(l)))}).filter(a=>!s.includes(a));throw new B(`Missing languages ${s.map(([a])=>`\`${a}\``).join(", ")}, required by ${o.map(([a])=>`\`${a}\``).join(", ")}`)}for(const[o,a]of r)this._resolver.addLanguage(a);for(const[o,a]of r)this.loadLanguage(a)}getLoadedLanguages(){return this._loadedLanguagesCache||(this._loadedLanguagesCache=[...new Set([...this._resolvedGrammars.keys(),...Object.keys(this._alias)])]),this._loadedLanguagesCache}resolveEmbeddedLanguages(e){if(this._langMap.set(e.name,e),this._langGraph.set(e.name,e),e.embeddedLangs)for(const r of e.embeddedLangs)this._langGraph.set(r,this._langMap.get(r))}}class st{constructor(t,e){_(this,"_langs",new Map);_(this,"_scopeToLang",new Map);_(this,"_injections",new Map);_(this,"_onigLib");this._onigLib={createOnigScanner:r=>t.createScanner(r),createOnigString:r=>t.createString(r)},e.forEach(r=>this.addLanguage(r))}get onigLib(){return this._onigLib}getLangRegistration(t){return this._langs.get(t)}loadGrammar(t){return this._scopeToLang.get(t)}addLanguage(t){this._langs.set(t.name,t),t.aliases&&t.aliases.forEach(e=>{this._langs.set(e,t)}),this._scopeToLang.set(t.scopeName,t),t.injectTo&&t.injectTo.forEach(e=>{this._injections.get(e)||this._injections.set(e,[]),this._injections.get(e).push(t.scopeName)})}getInjections(t){const e=t.split(".");let r=[];for(let s=1;s<=e.length;s++){const o=e.slice(0,s).join(".");r=[...r,...this._injections.get(o)||[]]}return r}}let O=0;function we(n){O+=1,n.warnings!==!1&&O>=10&&O%10===0&&console.warn(`[Shiki] ${O} instances have been created. Shiki is supposed to be used as a singleton, consider refactoring your code to cache your highlighter instance; Or call \`highlighter.dispose()\` to release unused instances.`);let t=!1;if(!n.engine)throw new B("`engine` option is required for synchronous mode");const e=(n.langs||[]).flat(1),r=(n.themes||[]).flat(1).map(ee),s=new st(n.engine,e),o=new rt(s,r,e,n.langAlias);let a;function i(p){h();const b=o.getGrammar(typeof p=="string"?p:p.name);if(!b)throw new B(`Language \`${p}\` not found, you may need to load it first`);return b}function c(p){if(p==="none")return{bg:"",fg:"",name:"none",settings:[],type:"dark"};h();const b=o.getTheme(p);if(!b)throw new B(`Theme \`${p}\` not found, you may need to load it first`);return b}function l(p){h();const b=c(p);a!==p&&(o.setTheme(b),a=p);const w=o.getColorMap();return{theme:b,colorMap:w}}function g(){return h(),o.getLoadedThemes()}function f(){return h(),o.getLoadedLanguages()}function u(...p){h(),o.loadLanguages(p.flat(1))}async function m(...p){return u(await be(p))}function y(...p){h();for(const b of p.flat(1))o.loadTheme(b)}async function k(...p){return h(),y(await ke(p))}function h(){if(t)throw new B("Shiki instance has been disposed")}function d(){t||(t=!0,o.dispose(),O-=1)}return{setTheme:l,getTheme:c,getLanguage:i,getLoadedThemes:g,getLoadedLanguages:f,loadLanguage:m,loadLanguageSync:u,loadTheme:k,loadThemeSync:y,dispose:d,[Symbol.dispose]:d}}async function ot(n){n.engine||nt("`engine` option is required. Use `createOnigurumaEngine` or `createJavaScriptRegexEngine` to create an engine.");const[t,e,r]=await Promise.all([ke(n.themes||[]),be(n.langs||[]),n.engine]);return we({...n,themes:t,langs:e,engine:r})}async function Se(n){const t=await ot(n);return{getLastGrammarState:(...e)=>pe(t,...e),codeToTokensBase:(e,r)=>V(t,e,r),codeToTokensWithThemes:(e,r)=>Z(t,e,r),codeToTokens:(e,r)=>G(t,e,r),codeToHast:(e,r)=>R(t,e,r),codeToHtml:(e,r)=>ye(t,e,r),getBundledLanguages:()=>({}),getBundledThemes:()=>({}),...t,getInternalContext:()=>t}}function dt(n){const t=we(n);return{getLastGrammarState:(...e)=>pe(t,...e),codeToTokensBase:(e,r)=>V(t,e,r),codeToTokensWithThemes:(e,r)=>Z(t,e,r),codeToTokens:(e,r)=>G(t,e,r),codeToHast:(e,r)=>R(t,e,r),codeToHtml:(e,r)=>ye(t,e,r),getBundledLanguages:()=>({}),getBundledThemes:()=>({}),...t,getInternalContext:()=>t}}function at(n){let t;async function e(r){if(t){const s=await t;return await Promise.all([s.loadTheme(...r.themes||[]),s.loadLanguage(...r.langs||[])]),s}else return t=n({...r,themes:r.themes||[],langs:r.langs||[]}),t}return e}const mt=at(Se);function pt(n){const t=n.langs,e=n.themes,r=n.engine;async function s(o){function a(f){if(typeof f=="string"){if(fe(f))return[];const u=t[f];if(!u)throw new T(`Language \`${f}\` is not included in this bundle. You may want to load it from external source.`);return u}return f}function i(f){if(ue(f))return"none";if(typeof f=="string"){const u=e[f];if(!u)throw new T(`Theme \`${f}\` is not included in this bundle. You may want to load it from external source.`);return u}return f}const c=(o.themes??[]).map(f=>i(f)),l=(o.langs??[]).map(f=>a(f)),g=await Se({engine:o.engine??r(),...o,themes:c,langs:l});return{...g,loadLanguage(...f){return g.loadLanguage(...f.map(a))},loadTheme(...f){return g.loadTheme(...f.map(i))},getBundledLanguages(){return t},getBundledThemes(){return e}}}return s}function it(n){let t;async function e(r={}){if(t){const s=await t;return await Promise.all([s.loadTheme(...r.themes||[]),s.loadLanguage(...r.langs||[])]),s}else return t=n({...r,themes:r.themes||[],langs:r.langs||[]}),t}return e}function yt(n,t){const e=it(n);async function r(s,o){var c;const a=await e({langs:[o.lang],themes:"theme"in o?[o.theme]:Object.values(o.themes)}),i=await((c=t==null?void 0:t.guessEmbeddedLanguages)==null?void 0:c.call(t,s,o.lang,a));return i&&await a.loadLanguage(...i),a}return{getSingletonHighlighter(s){return e(s)},async codeToHtml(s,o){return(await r(s,o)).codeToHtml(s,o)},async codeToHast(s,o){return(await r(s,o)).codeToHast(s,o)},async codeToTokens(s,o){return(await r(s,o)).codeToTokens(s,o)},async codeToTokensBase(s,o){return(await r(s,o)).codeToTokensBase(s,o)},async codeToTokensWithThemes(s,o){return(await r(s,o)).codeToTokensWithThemes(s,o)},async getLastGrammarState(s,o){return(await e({langs:[o.lang],themes:[o.theme]})).getLastGrammarState(s,o)}}}function bt(n={}){var a;const{name:t="css-variables",variablePrefix:e="--shiki-",fontStyle:r=!0}=n,s=i=>{var c;return(c=n.variableDefaults)!=null&&c[i]?`var(${e}${i}, ${n.variableDefaults[i]})`:`var(${e}${i})`},o={name:t,type:"dark",colors:{"editor.foreground":s("foreground"),"editor.background":s("background"),"terminal.ansiBlack":s("ansi-black"),"terminal.ansiRed":s("ansi-red"),"terminal.ansiGreen":s("ansi-green"),"terminal.ansiYellow":s("ansi-yellow"),"terminal.ansiBlue":s("ansi-blue"),"terminal.ansiMagenta":s("ansi-magenta"),"terminal.ansiCyan":s("ansi-cyan"),"terminal.ansiWhite":s("ansi-white"),"terminal.ansiBrightBlack":s("ansi-bright-black"),"terminal.ansiBrightRed":s("ansi-bright-red"),"terminal.ansiBrightGreen":s("ansi-bright-green"),"terminal.ansiBrightYellow":s("ansi-bright-yellow"),"terminal.ansiBrightBlue":s("ansi-bright-blue"),"terminal.ansiBrightMagenta":s("ansi-bright-magenta"),"terminal.ansiBrightCyan":s("ansi-bright-cyan"),"terminal.ansiBrightWhite":s("ansi-bright-white")},tokenColors:[{scope:["keyword.operator.accessor","meta.group.braces.round.function.arguments","meta.template.expression","markup.fenced_code meta.embedded.block"],settings:{foreground:s("foreground")}},{scope:"emphasis",settings:{fontStyle:"italic"}},{scope:["strong","markup.heading.markdown","markup.bold.markdown"],settings:{fontStyle:"bold"}},{scope:["markup.italic.markdown"],settings:{fontStyle:"italic"}},{scope:"meta.link.inline.markdown",settings:{fontStyle:"underline",foreground:s("token-link")}},{scope:["string","markup.fenced_code","markup.inline"],settings:{foreground:s("token-string")}},{scope:["comment","string.quoted.docstring.multi"],settings:{foreground:s("token-comment")}},{scope:["constant.numeric","constant.language","constant.other.placeholder","constant.character.format.placeholder","variable.language.this","variable.other.object","variable.other.class","variable.other.constant","meta.property-name","meta.property-value","support"],settings:{foreground:s("token-constant")}},{scope:["keyword","storage.modifier","storage.type","storage.control.clojure","entity.name.function.clojure","entity.name.tag.yaml","support.function.node","support.type.property-name.json","punctuation.separator.key-value","punctuation.definition.template-expression"],settings:{foreground:s("token-keyword")}},{scope:"variable.parameter.function",settings:{foreground:s("token-parameter")}},{scope:["support.function","entity.name.type","entity.other.inherited-class","meta.function-call","meta.instance.constructor","entity.other.attribute-name","entity.name.function","constant.keyword.clojure"],settings:{foreground:s("token-function")}},{scope:["entity.name.tag","string.quoted","string.regexp","string.interpolated","string.template","string.unquoted.plain.out.yaml","keyword.other.template"],settings:{foreground:s("token-string-expression")}},{scope:["punctuation.definition.arguments","punctuation.definition.dict","punctuation.separator","meta.function-call.arguments"],settings:{foreground:s("token-punctuation")}},{scope:["markup.underline.link","punctuation.definition.metadata.markdown"],settings:{foreground:s("token-link")}},{scope:["beginning.punctuation.definition.list.markdown"],settings:{foreground:s("token-string")}},{scope:["punctuation.definition.string.begin.markdown","punctuation.definition.string.end.markdown","string.other.link.title.markdown","string.other.link.description.markdown"],settings:{foreground:s("token-keyword")}},{scope:["markup.inserted","meta.diff.header.to-file","punctuation.definition.inserted"],settings:{foreground:s("token-inserted")}},{scope:["markup.deleted","meta.diff.header.from-file","punctuation.definition.deleted"],settings:{foreground:s("token-deleted")}},{scope:["markup.changed","punctuation.definition.changed"],settings:{foreground:s("token-changed")}}]};return r||(o.tokenColors=(a=o.tokenColors)==null?void 0:a.map(i=>{var c;return(c=i.settings)!=null&&c.fontStyle&&delete i.settings.fontStyle,i})),o}export{T as ShikiError,ge as addClassToHast,N as applyColorReplacements,R as codeToHast,ye as codeToHtml,G as codeToTokens,V as codeToTokensBase,Z as codeToTokensWithThemes,bt as createCssVariablesTheme,Se as createHighlighterCore,dt as createHighlighterCoreSync,Ne as createPositionConverter,ot as createShikiInternal,we as createShikiInternalSync,yt as createSingletonShorthands,pt as createdBundledHighlighter,ht as enableDeprecationWarnings,Be as flatTokenVariants,mt as getSingletonHighlighterCore,he as getTokenStyleObject,gt as guessEmbeddedLanguages,tt as hastToHtml,X as isNoneTheme,Q as isPlainLang,fe as isSpecialLang,ue as isSpecialTheme,it as makeSingletonHighlighter,at as makeSingletonHighlighterCore,le as normalizeGetter,ee as normalizeTheme,P as resolveColorReplacements,z as splitLines,Ee as splitToken,Ie as splitTokens,je as stringifyTokenStyle,$e as toArray,ze as tokenizeAnsiWithTheme,Ve as tokenizeWithTheme,Xe as tokensToHast,Ae as transformerDecorations,nt as warnDeprecated};
