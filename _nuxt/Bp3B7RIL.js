import{d as rt,c as F,k as at,aj as ct,ak as it,Z as ft,an as ut,ao as pt,f as P,P as W,C as R,u as B,n as X,V as q,X as dt,o as V,ap as ht,_ as mt}from"./DuM02_51.js";function Z(n,t,e,s){let o=0;for(;o<n.length;o++){const g=(e==null?void 0:e(o))??t[o];if(n[o]!==g||s!=null&&s(o))break}let l=n.length-1,h=t.length-1;for(;l>=0&&h>=0;l--,h--){const g=(e==null?void 0:e(h))??t[h];if(n[l]!==g||s!=null&&s(h))break}return o>l&&([o,l]=[l,o]),o=Math.max(0,o),l=Math.min(n.length-1,l)+1,n.length===t.length&&o+1===l?[o,l]:gt([...n],o,l)}function gt(n,t,e){const s=o(Math.max(0,t+e-n.length));t-=s,e+=s;function o(m){const a=n.slice(0,t).indexOf(n[e],m);if(a===-1)return 0;for(let r=a,i=e;r<t-1;i++,r++)if(n[r+1]!==n[i+1])return o(m+1);return t-a}const l=n.join(`
`),h=n.slice(0,t).join(`
`).length,g=n.slice(0,e).join(`
`).length,x=[];for(let m=t-1,a=g-1;m<e&&a>=h;m--){const r=n[m],i=l.lastIndexOf(r,a);if(i!==-1&&i>=h)x.push(r),a=i-1;else break}const v=[];for(let m=e,a=h;m>=t&&a<g;m++){const r=n[m],i=l.indexOf(r,a);if(i!==-1&&i<g)v.push(r),a=i+1;else break}return[t-x.length,e+v.length]}function St(n,t){let e=0,s;return function(...o){s&&(clearTimeout(s),s=void 0);const l=performance.now();!e||l-e>=t?(n.apply(this,o),e=l):s=setTimeout(()=>{n.apply(this,o),e=performance.now(),s=void 0},t+e-l)}}function kt(n){let t=!1;return function(...e){return t?!1:(t=!0,n.apply(this,e),!0)}}function yt(n,t){if(n.length!==t.length)return!1;for(let e=0;e<n.length;e++)if(n[e]!==t[e])return!1;return!0}function Ct(n){const t=()=>"CSS"in globalThis&&"highlights"in CSS;function e(s,o){const{lang:l,themes:h={light:"min-light",dark:"min-dark"},defaultTheme:g="light",selector:x=C=>`.${C}`,defaultSelector:v=":root",watch:m=!0,delay:a=33.4}=o,r=new CSSStyleSheet;document.adoptedStyleSheets.push(r);const i=new Map,c=[];function A(C,d){for(const{range:S,name:p}of z(d)){const f=CSS.highlights.get(p);f==null||f.delete(S);const u=i.get(p);u==null||u.delete(S)}for(const{range:S,color:p,theme:f,name:u}of z(C)){const k=f===g;let w=CSS.highlights.get(u);w||(CSS.highlights.set(u,w=new Highlight),w.priority=k?0:1);let b=i.get(u);if(!b){i.set(u,b=new Set);const _=`${k?v:x(f)}::highlight(${u}) { color: ${p}; }`;r.insertRule(_)}w.add(S),b.add(S)}}function K(C,d,S){var O;if(S-d>1||c.length<=d)return;const p=C[d],f=c[d],u=Z(p,f.text),k=f.offset+u[0],w=f.offset+u[1],b=(O=f.loads)==null?void 0:O.find(({range:E})=>k>=E.startOffset&&k<E.endOffset);if(!b)return;const{range:_}=b;_.setEnd(_.endContainer,Math.max(_.endOffset,w))}const Q=St((C,d,S,p,f)=>{var O,E,D,H,U;const u=f-d.length+c.length,k=c.splice(u);for(let y=p;y<u;y++)A([],((O=c[y])==null?void 0:O.loads)??[]);const w=(E=c.at(-1))==null?void 0:E.lastGrammarState;c.length=f-1,c.fill(null,p,f-1),c.push(J({lastGrammarState:w}),...k);let b=d.slice(0,p).reduce((y,$)=>y+$.length+1,0);const _=vt(C,S,b);for(let y=p;y<d.length;y++){const $=d[y],G=n.codeToTokens($,{lang:l,themes:h,cssVariablePrefix:"",defaultColor:!1,grammarState:(D=c[y-1])==null?void 0:D.lastGrammarState}),M=[];for(const I of G.tokens[0]){const[nt,ot]=_(b+I.offset),[st,lt]=_(b+I.offset+I.content.length),T=document.createRange();T.setStart(nt,ot),T.setEnd(st,lt),M.push({token:I,range:T})}const N=c[y]??(c[y]=J());A(M,N.loads),N.loads=M,N.text=$,N.offset=b;const L=((H=N.lastGrammarState)==null?void 0:H.getScopes())??[Number.NaN],tt=((U=G.grammarState)==null?void 0:U.getScopes())??[Number.NaN],et=yt(L,tt);if(N.lastGrammarState=G.grammarState,!et)b+=$.length+1;else break}},a);t()&&(m&&s.addEventListener("input",j),j());const Y=kt(()=>{m&&s.removeEventListener("input",j);const C=document.adoptedStyleSheets.indexOf(r);document.adoptedStyleSheets.splice(C,1);for(const[d,S]of i){const p=CSS.highlights.get(d);for(const f of S)p==null||p.delete(f)}});function j(){const{innerText:C}=s,d=C.split(`
`),S=bt(s),[p,f]=Z(d,c,u=>{var k;return(k=c[u])==null?void 0:k.text},u=>{var k;return(k=c[u])==null?void 0:k.loads.some(({range:w})=>w.collapsed)});K(d,p,f),Q(C,d,S,p,f)}return{dispose:Y,update:j}}return{get isSupported(){return t()},mount:e}}function*z(n){for(const{token:t,range:e}of n)if(typeof t.htmlStyle=="object")for(const s in t.htmlStyle){const o=t.htmlStyle[s],l=`shiki-${s}-${o.slice(1).toLowerCase()}`;yield{range:e,color:o,theme:s,name:l}}}function bt(n){const t=document.createTreeWalker(n,NodeFilter.SHOW_TEXT),e=[];let s;for(;s=t.nextNode();)e.push(s);return e}function J(n={}){return{text:"",offset:0,lastGrammarState:void 0,loads:[],...n}}function vt(n,t,e){let s=0,o=0,l=!1;return e>0&&h(e),h;function h(g){for(;s<t.length;s++){const x=t[s],{textContent:v}=x;if(v)if(l||(o=n.indexOf(v,o),l=!0),o+v.length<g)o+=v.length,l=!1;else break}return[t[s],g-o]}}const wt={class:"copy"},xt={key:0,class:"prompt"},_t=["textContent"],Nt=rt({__name:"Copy",props:{prompt:{type:[String,Boolean],default:"$"},code:{},lang:{}},setup(n){const t=n,e=F(()=>t.prompt!==!0),s=F(()=>t.lang??ht(t.prompt)),o=at(!1),l=ct("code-input"),{copy:h,copied:g}=it(l);function x(){l.value&&(l.value.textContent=t.code??"",l.value.dispatchEvent(new Event("input")),o.value=!1)}function v(a){const{data:r,inputType:i}=a;(r!=null&&r.includes(`
`)||i==="insertLineBreak")&&a.preventDefault()}function m(a){o.value=t.code!==a.target.textContent}return ft(async()=>{const a=await ut(),r=await pt({lang:s.value});Ct(a).mount(l.value,r)}),(a,r)=>{const i=dt;return V(),P("code",wt,[B(e)?(V(),P("span",xt,X(a.prompt),1)):W("",!0),R("div",{ref:"code-input",contenteditable:"plaintext-only",class:"code",spellcheck:"false",onBeforeinput:r[0]||(r[0]=c=>v(c)),onInput:r[1]||(r[1]=c=>m(c)),textContent:X(a.code)},null,40,_t),r[3]||(r[3]=R("div",{class:"mask"},null,-1)),B(o)?(V(),P("button",{key:1,class:"operation","aria-label":"恢复原始内容",onClick:x},[q(i,{name:"ph:arrow-u-up-left-bold"})])):W("",!0),R("button",{class:"operation","aria-label":"复制",onClick:r[2]||(r[2]=c=>B(h)())},[q(i,{name:B(g)?"ph:check-bold":"ph:copy-bold"},null,8,["name"])])])}}}),Et=mt(Nt,[["__scopeId","data-v-b8f384bf"]]);export{Et as default};
