var _e=Object.defineProperty;var ve=(n,e,t)=>e in n?_e(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var _=(n,e,t)=>ve(n,typeof e!="symbol"?e+"":e,t);import{t as Le,F as x,I as U,R as Ce,T as xe,E as re}from"./DGBHXtJB.js";import"./CiDwHVmI.js";let T=class extends Error{constructor(e){super(e),this.name="ShikiError"}};function P(n,e){const t=typeof n=="string"?{}:{...n.colorReplacements},r=typeof n=="string"?n:n.name;for(const[s,o]of Object.entries((e==null?void 0:e.colorReplacements)||{}))typeof o=="string"?t[s]=o:s===r&&Object.assign(t,o);return t}function N(n,e){return n&&((e==null?void 0:e[n==null?void 0:n.toLowerCase()])||n)}function $e(n){return Array.isArray(n)?n:[n]}async function le(n){return Promise.resolve(typeof n=="function"?n():n).then(e=>e.default||e)}function Q(n){return!n||["plaintext","txt","text","plain"].includes(n)}function fe(n){return n==="ansi"||Q(n)}function X(n){return n==="none"}function ue(n){return X(n)}function ge(n,e){var r;if(!e)return n;n.properties||(n.properties={}),(r=n.properties).class||(r.class=[]),typeof n.properties.class=="string"&&(n.properties.class=n.properties.class.split(/\s+/g)),Array.isArray(n.properties.class)||(n.properties.class=[]);const t=Array.isArray(e)?e:e.split(/\s+/g);for(const s of t)s&&!n.properties.class.includes(s)&&n.properties.class.push(s);return n}function z(n,e=!1){var o;const t=n.split(/(\r?\n)/g);let r=0;const s=[];for(let a=0;a<t.length;a+=2){const i=e?t[a]+(t[a+1]||""):t[a];s.push([i,r]),r+=t[a].length,r+=((o=t[a+1])==null?void 0:o.length)||0}return s}function Ne(n){const e=z(n,!0).map(([s])=>s);function t(s){if(s===n.length)return{line:e.length-1,character:e[e.length-1].length};let o=s,a=0;for(const i of e){if(o<i.length)break;o-=i.length,a++}return{line:a,character:o}}function r(s,o){let a=0;for(let i=0;i<s;i++)a+=e[i].length;return a+=o,a}return{lines:e,indexToPos:t,posToIndex:r}}function gt(n,e,t){const r=new Set;for(const o of n.matchAll(/lang=["']([\w-]+)["']/g))r.add(o[1]);for(const o of n.matchAll(/(?:```|~~~)([\w-]+)/g))r.add(o[1]);for(const o of n.matchAll(/\\begin\{([\w-]+)\}/g))r.add(o[1]);if(!t)return Array.from(r);const s=t.getBundledLanguages();return Array.from(r).filter(o=>o&&s[o])}function Ee(n,e){let t=0;const r=[];for(const s of e)s>t&&r.push({...n,content:n.content.slice(t,s),offset:n.offset+t}),t=s;return t<n.content.length&&r.push({...n,content:n.content.slice(t),offset:n.offset+t}),r}function Ie(n,e){const t=Array.from(e instanceof Set?e:new Set(e)).sort((r,s)=>r-s);return t.length?n.map(r=>r.flatMap(s=>{const o=t.filter(a=>s.offset<a&&a<s.offset+s.content.length).map(a=>a-s.offset).sort((a,i)=>a-i);return o.length?Ee(s,o):s})):n}function Be(n,e,t,r){const s={content:n.content,explanation:n.explanation,offset:n.offset},o=e.map(c=>he(n.variants[c])),a=new Set(o.flatMap(c=>Object.keys(c))),i={};return o.forEach((c,l)=>{for(const g of a){const f=c[g]||"inherit";if(l===0&&r)i[g]=f;else{const u=g==="color"?"":g==="background-color"?"-bg":`-${g}`,m=t+e[l]+(g==="color"?"":u);i[m]=f}}}),s.htmlStyle=i,s}function he(n){const e={};return n.color&&(e.color=n.color),n.bgColor&&(e["background-color"]=n.bgColor),n.fontStyle&&(n.fontStyle&x.Italic&&(e["font-style"]="italic"),n.fontStyle&x.Bold&&(e["font-weight"]="bold"),n.fontStyle&x.Underline&&(e["text-decoration"]="underline")),e}function je(n){return typeof n=="string"?n:Object.entries(n).map(([e,t])=>`${e}:${t}`).join(";")}const de=new WeakMap;function J(n,e){de.set(n,e)}function A(n){return de.get(n)}class j{constructor(...e){_(this,"_stacks",{});_(this,"lang");if(e.length===2){const[t,r]=e;this.lang=r,this._stacks=t}else{const[t,r,s]=e;this.lang=r,this._stacks={[s]:t}}}get themes(){return Object.keys(this._stacks)}get theme(){return this.themes[0]}get _stack(){return this._stacks[this.theme]}static initial(e,t){return new j(Object.fromEntries($e(t).map(r=>[r,U])),e)}getInternalStack(e=this.theme){return this._stacks[e]}getScopes(e=this.theme){return Me(this._stacks[e])}toJSON(){return{lang:this.lang,theme:this.theme,themes:this.themes,scopes:this.getScopes()}}}function Me(n){const e=[],t=new Set;function r(s){var a;if(t.has(s))return;t.add(s);const o=(a=s==null?void 0:s.nameScopesList)==null?void 0:a.scopeName;o&&e.push(o),s.parent&&r(s.parent)}return r(n),e}function Oe(n,e){if(!(n instanceof j))throw new T("Invalid grammar state");return n.getInternalStack(e)}function Ae(){const n=new WeakMap;function e(t){if(!n.has(t.meta)){let r=function(a){if(typeof a=="number"){if(a<0||a>t.source.length)throw new T(`Invalid decoration offset: ${a}. Code length: ${t.source.length}`);return{...s.indexToPos(a),offset:a}}else{const i=s.lines[a.line];if(i===void 0)throw new T(`Invalid decoration position ${JSON.stringify(a)}. Lines length: ${s.lines.length}`);if(a.character<0||a.character>i.length)throw new T(`Invalid decoration position ${JSON.stringify(a)}. Line ${a.line} length: ${i.length}`);return{...a,offset:s.posToIndex(a.line,a.character)}}};const s=Ne(t.source),o=(t.options.decorations||[]).map(a=>({...a,start:r(a.start),end:r(a.end)}));Ge(o),n.set(t.meta,{decorations:o,converter:s,source:t.source})}return n.get(t.meta)}return{name:"shiki:decorations",tokens(t){var a;if(!((a=this.options.decorations)!=null&&a.length))return;const s=e(this).decorations.flatMap(i=>[i.start.offset,i.end.offset]);return Ie(t,s)},code(t){var g;if(!((g=this.options.decorations)!=null&&g.length))return;const r=e(this),s=Array.from(t.children).filter(f=>f.type==="element"&&f.tagName==="span");if(s.length!==r.converter.lines.length)throw new T(`Number of lines in code element (${s.length}) does not match the number of lines in the source (${r.converter.lines.length}). Failed to apply decorations.`);function o(f,u,m,y){const k=s[f];let h="",d=-1,p=-1;if(u===0&&(d=0),m===0&&(p=0),m===Number.POSITIVE_INFINITY&&(p=k.children.length),d===-1||p===-1)for(let w=0;w<k.children.length;w++)h+=me(k.children[w]),d===-1&&h.length===u&&(d=w+1),p===-1&&h.length===m&&(p=w+1);if(d===-1)throw new T(`Failed to find start index for decoration ${JSON.stringify(y.start)}`);if(p===-1)throw new T(`Failed to find end index for decoration ${JSON.stringify(y.end)}`);const b=k.children.slice(d,p);if(!y.alwaysWrap&&b.length===k.children.length)i(k,y,"line");else if(!y.alwaysWrap&&b.length===1&&b[0].type==="element")i(b[0],y,"token");else{const w={type:"element",tagName:"span",properties:{},children:b};i(w,y,"wrapper"),k.children.splice(d,b.length,w)}}function a(f,u){s[f]=i(s[f],u,"line")}function i(f,u,m){var h;const y=u.properties||{},k=u.transform||(d=>d);return f.tagName=u.tagName||"span",f.properties={...f.properties,...y,class:f.properties.class},(h=u.properties)!=null&&h.class&&ge(f,u.properties.class),f=k(f,m)||f,f}const c=[],l=r.decorations.sort((f,u)=>u.start.offset-f.start.offset||f.end.offset-u.end.offset);for(const f of l){const{start:u,end:m}=f;if(u.line===m.line)o(u.line,u.character,m.character,f);else if(u.line<m.line){o(u.line,u.character,Number.POSITIVE_INFINITY,f);for(let y=u.line+1;y<m.line;y++)c.unshift(()=>a(y,f));o(m.line,0,m.character,f)}}c.forEach(f=>f())}}}function Ge(n){for(let e=0;e<n.length;e++){const t=n[e];if(t.start.offset>t.end.offset)throw new T(`Invalid decoration range: ${JSON.stringify(t.start)} - ${JSON.stringify(t.end)}`);for(let r=e+1;r<n.length;r++){const s=n[r],o=t.start.offset<=s.start.offset&&s.start.offset<t.end.offset,a=t.start.offset<s.end.offset&&s.end.offset<=t.end.offset,i=s.start.offset<=t.start.offset&&t.start.offset<s.end.offset,c=s.start.offset<t.end.offset&&t.end.offset<=s.end.offset;if(o||a||i||c){if(o&&a||i&&c)continue;throw new T(`Decorations ${JSON.stringify(t.start)} and ${JSON.stringify(s.start)} intersect.`)}}}}function me(n){return n.type==="text"?n.value:n.type==="element"?n.children.map(me).join(""):""}const Re=[Ae()];function F(n){return[...n.transformers||[],...Re]}var E=["black","red","green","yellow","blue","magenta","cyan","white","brightBlack","brightRed","brightGreen","brightYellow","brightBlue","brightMagenta","brightCyan","brightWhite"],K={1:"bold",2:"dim",3:"italic",4:"underline",7:"reverse",8:"hidden",9:"strikethrough"};function He(n,e){const t=n.indexOf("\x1B",e);if(t!==-1&&n[t+1]==="["){const r=n.indexOf("m",t);if(r!==-1)return{sequence:n.substring(t+2,r).split(";"),startPosition:t,position:r+1}}return{position:n.length}}function se(n){const e=n.shift();if(e==="2"){const t=n.splice(0,3).map(r=>Number.parseInt(r));return t.length!==3||t.some(r=>Number.isNaN(r))?void 0:{type:"rgb",rgb:t}}else if(e==="5"){const t=n.shift();if(t)return{type:"table",index:Number(t)}}}function We(n){const e=[];for(;n.length>0;){const t=n.shift();if(!t)continue;const r=Number.parseInt(t);if(!Number.isNaN(r))if(r===0)e.push({type:"resetAll"});else if(r<=9)K[r]&&e.push({type:"setDecoration",value:K[r]});else if(r<=29){const s=K[r-20];s&&(e.push({type:"resetDecoration",value:s}),s==="dim"&&e.push({type:"resetDecoration",value:"bold"}))}else if(r<=37)e.push({type:"setForegroundColor",value:{type:"named",name:E[r-30]}});else if(r===38){const s=se(n);s&&e.push({type:"setForegroundColor",value:s})}else if(r===39)e.push({type:"resetForegroundColor"});else if(r<=47)e.push({type:"setBackgroundColor",value:{type:"named",name:E[r-40]}});else if(r===48){const s=se(n);s&&e.push({type:"setBackgroundColor",value:s})}else r===49?e.push({type:"resetBackgroundColor"}):r===53?e.push({type:"setDecoration",value:"overline"}):r===55?e.push({type:"resetDecoration",value:"overline"}):r>=90&&r<=97?e.push({type:"setForegroundColor",value:{type:"named",name:E[r-90+8]}}):r>=100&&r<=107&&e.push({type:"setBackgroundColor",value:{type:"named",name:E[r-100+8]}})}return e}function Pe(){let n=null,e=null,t=new Set;return{parse(r){const s=[];let o=0;do{const a=He(r,o),i=a.sequence?r.substring(o,a.startPosition):r.substring(o);if(i.length>0&&s.push({value:i,foreground:n,background:e,decorations:new Set(t)}),a.sequence){const c=We(a.sequence);for(const l of c)l.type==="resetAll"?(n=null,e=null,t.clear()):l.type==="resetForegroundColor"?n=null:l.type==="resetBackgroundColor"?e=null:l.type==="resetDecoration"&&t.delete(l.value);for(const l of c)l.type==="setForegroundColor"?n=l.value:l.type==="setBackgroundColor"?e=l.value:l.type==="setDecoration"&&t.add(l.value)}o=a.position}while(o<r.length);return s}}}var Fe={black:"#000000",red:"#bb0000",green:"#00bb00",yellow:"#bbbb00",blue:"#0000bb",magenta:"#ff00ff",cyan:"#00bbbb",white:"#eeeeee",brightBlack:"#555555",brightRed:"#ff5555",brightGreen:"#00ff00",brightYellow:"#ffff55",brightBlue:"#5555ff",brightMagenta:"#ff55ff",brightCyan:"#55ffff",brightWhite:"#ffffff"};function De(n=Fe){function e(i){return n[i]}function t(i){return`#${i.map(c=>Math.max(0,Math.min(c,255)).toString(16).padStart(2,"0")).join("")}`}let r;function s(){if(r)return r;r=[];for(let l=0;l<E.length;l++)r.push(e(E[l]));let i=[0,95,135,175,215,255];for(let l=0;l<6;l++)for(let g=0;g<6;g++)for(let f=0;f<6;f++)r.push(t([i[l],i[g],i[f]]));let c=8;for(let l=0;l<24;l++,c+=10)r.push(t([c,c,c]));return r}function o(i){return s()[i]}function a(i){switch(i.type){case"named":return e(i.name);case"rgb":return t(i.rgb);case"table":return o(i.index)}}return{value:a}}function ze(n,e,t){const r=P(n,t),s=z(e),o=De(Object.fromEntries(E.map(i=>{var c;return[i,(c=n.colors)==null?void 0:c[`terminal.ansi${i[0].toUpperCase()}${i.substring(1)}`]]}))),a=Pe();return s.map(i=>a.parse(i[0]).map(c=>{let l,g;c.decorations.has("reverse")?(l=c.background?o.value(c.background):n.bg,g=c.foreground?o.value(c.foreground):n.fg):(l=c.foreground?o.value(c.foreground):n.fg,g=c.background?o.value(c.background):void 0),l=N(l,r),g=N(g,r),c.decorations.has("dim")&&(l=Je(l));let f=x.None;return c.decorations.has("bold")&&(f|=x.Bold),c.decorations.has("italic")&&(f|=x.Italic),c.decorations.has("underline")&&(f|=x.Underline),{content:c.value,offset:i[1],color:l,bgColor:g,fontStyle:f}}))}function Je(n){const e=n.match(/#([0-9a-f]{3})([0-9a-f]{3})?([0-9a-f]{2})?/);if(e)if(e[3]){const r=Math.round(Number.parseInt(e[3],16)/2).toString(16).padStart(2,"0");return`#${e[1]}${e[2]}${r}`}else return e[2]?`#${e[1]}${e[2]}80`:`#${Array.from(e[1]).map(r=>`${r}${r}`).join("")}80`;const t=n.match(/var\((--[\w-]+-ansi-[\w-]+)\)/);return t?`var(${t[1]}-dim)`:n}function V(n,e,t={}){const{lang:r="text",theme:s=n.getLoadedThemes()[0]}=t;if(Q(r)||X(s))return z(e).map(c=>[{content:c[0],offset:c[1]}]);const{theme:o,colorMap:a}=n.setTheme(s);if(r==="ansi")return ze(o,e,t);const i=n.getLanguage(r);if(t.grammarState){if(t.grammarState.lang!==i.name)throw new T(`Grammar state language "${t.grammarState.lang}" does not match highlight language "${i.name}"`);if(!t.grammarState.themes.includes(o.name))throw new T(`Grammar state themes "${t.grammarState.themes}" do not contain highlight theme "${o.name}"`)}return Ve(e,i,o,a,t)}function pe(...n){if(n.length===2)return A(n[1]);const[e,t,r={}]=n,{lang:s="text",theme:o=e.getLoadedThemes()[0]}=r;if(Q(s)||X(o))throw new T("Plain language does not have grammar state");if(s==="ansi")throw new T("ANSI language does not have grammar state");const{theme:a,colorMap:i}=e.setTheme(o),c=e.getLanguage(s);return new j(D(t,c,a,i,r).stateStack,c.name,a.name)}function Ve(n,e,t,r,s){const o=D(n,e,t,r,s),a=new j(D(n,e,t,r,s).stateStack,e.name,t.name);return J(o.tokens,a),o.tokens}function D(n,e,t,r,s){const o=P(t,s),{tokenizeMaxLineLength:a=0,tokenizeTimeLimit:i=500}=s,c=z(n);let l=s.grammarState?Oe(s.grammarState,t.name)??U:s.grammarContextCode!=null?D(s.grammarContextCode,e,t,r,{...s,grammarState:void 0,grammarContextCode:void 0}).stateStack:U,g=[];const f=[];for(let u=0,m=c.length;u<m;u++){const[y,k]=c[u];if(y===""){g=[],f.push([]);continue}if(a>0&&y.length>=a){g=[],f.push([{content:y,offset:k,color:"",fontStyle:0}]);continue}let h,d,p;s.includeExplanation&&(h=e.tokenizeLine(y,l,i),d=h.tokens,p=0);const b=e.tokenizeLine2(y,l,i),w=b.tokens.length/2;for(let v=0;v<w;v++){const $=b.tokens[2*v],S=v+1<w?b.tokens[2*v+2]:y.length;if($===S)continue;const L=b.tokens[2*v+1],H=N(r[re.getForeground(L)],o),M=re.getFontStyle(L),Y={content:y.substring($,S),offset:k+$,color:H,fontStyle:M};if(s.includeExplanation){const te=[];if(s.includeExplanation!=="scopeName")for(const C of t.settings){let I;switch(typeof C.scope){case"string":I=C.scope.split(/,/).map(q=>q.trim());break;case"object":I=C.scope;break;default:continue}te.push({settings:C,selectors:I.map(q=>q.split(/ /))})}Y.explanation=[];let ne=0;for(;$+ne<S;){const C=d[p],I=y.substring(C.startIndex,C.endIndex);ne+=I.length,Y.explanation.push({content:I,scopes:s.includeExplanation==="scopeName"?Ye(C.scopes):qe(te,C.scopes)}),p+=1}}g.push(Y)}f.push(g),g=[],l=b.ruleStack}return{tokens:f,stateStack:l}}function Ye(n){return n.map(e=>({scopeName:e}))}function qe(n,e){const t=[];for(let r=0,s=e.length;r<s;r++){const o=e[r];t[r]={scopeName:o,themeMatches:Ue(n,o,e.slice(0,r))}}return t}function oe(n,e){return n===e||e.substring(0,n.length)===n&&e[n.length]==="."}function Ke(n,e,t){if(!oe(n[n.length-1],e))return!1;let r=n.length-2,s=t.length-1;for(;r>=0&&s>=0;)oe(n[r],t[s])&&(r-=1),s-=1;return r===-1}function Ue(n,e,t){const r=[];for(const{selectors:s,settings:o}of n)for(const a of s)if(Ke(a,e,t)){r.push(o);break}return r}function Z(n,e,t){const r=Object.entries(t.themes).filter(c=>c[1]).map(c=>({color:c[0],theme:c[1]})),s=r.map(c=>{const l=V(n,e,{...t,theme:c.theme}),g=A(l),f=typeof c.theme=="string"?c.theme:c.theme.name;return{tokens:l,state:g,theme:f}}),o=Qe(...s.map(c=>c.tokens)),a=o[0].map((c,l)=>c.map((g,f)=>{const u={content:g.content,variants:{},offset:g.offset};return"includeExplanation"in t&&t.includeExplanation&&(u.explanation=g.explanation),o.forEach((m,y)=>{const{content:k,explanation:h,offset:d,...p}=m[l][f];u.variants[r[y].color]=p}),u})),i=s[0].state?new j(Object.fromEntries(s.map(c=>{var l;return[c.theme,(l=c.state)==null?void 0:l.getInternalStack(c.theme)]})),s[0].state.lang):void 0;return i&&J(a,i),a}function Qe(...n){const e=n.map(()=>[]),t=n.length;for(let r=0;r<n[0].length;r++){const s=n.map(c=>c[r]),o=e.map(()=>[]);e.forEach((c,l)=>c.push(o[l]));const a=s.map(()=>0),i=s.map(c=>c[0]);for(;i.every(c=>c);){const c=Math.min(...i.map(l=>l.content.length));for(let l=0;l<t;l++){const g=i[l];g.content.length===c?(o[l].push(g),a[l]+=1,i[l]=s[l][a[l]]):(o[l].push({...g,content:g.content.slice(0,c)}),i[l]={...g,content:g.content.slice(c),offset:g.offset+c})}}}return e}function G(n,e,t){let r,s,o,a,i,c;if("themes"in t){const{defaultColor:l="light",cssVariablePrefix:g="--shiki-"}=t,f=Object.entries(t.themes).filter(h=>h[1]).map(h=>({color:h[0],theme:h[1]})).sort((h,d)=>h.color===l?-1:d.color===l?1:0);if(f.length===0)throw new T("`themes` option must not be empty");const u=Z(n,e,t);if(c=A(u),l&&!f.find(h=>h.color===l))throw new T(`\`themes\` option must contain the defaultColor key \`${l}\``);const m=f.map(h=>n.getTheme(h.theme)),y=f.map(h=>h.color);o=u.map(h=>h.map(d=>Be(d,y,g,l))),c&&J(o,c);const k=f.map(h=>P(h.theme,t));s=f.map((h,d)=>(d===0&&l?"":`${g+h.color}:`)+(N(m[d].fg,k[d])||"inherit")).join(";"),r=f.map((h,d)=>(d===0&&l?"":`${g+h.color}-bg:`)+(N(m[d].bg,k[d])||"inherit")).join(";"),a=`shiki-themes ${m.map(h=>h.name).join(" ")}`,i=l?void 0:[s,r].join(";")}else if("theme"in t){const l=P(t.theme,t);o=V(n,e,t);const g=n.getTheme(t.theme);r=N(g.bg,l),s=N(g.fg,l),a=g.name,c=A(o)}else throw new T("Invalid options, either `theme` or `themes` must be provided");return{tokens:o,fg:s,bg:r,themeName:a,rootStyle:i,grammarState:c}}function R(n,e,t,r={meta:{},options:t,codeToHast:(s,o)=>R(n,s,o),codeToTokens:(s,o)=>G(n,s,o)}){var m,y;let s=e;for(const k of F(t))s=((m=k.preprocess)==null?void 0:m.call(r,s,t))||s;let{tokens:o,fg:a,bg:i,themeName:c,rootStyle:l,grammarState:g}=G(n,s,t);const{mergeWhitespaces:f=!0}=t;f===!0?o=Ze(o):f==="never"&&(o=et(o));const u={...r,get source(){return s}};for(const k of F(t))o=((y=k.tokens)==null?void 0:y.call(u,o))||o;return Xe(o,{...t,fg:a,bg:i,themeName:c,rootStyle:l},u,g)}function Xe(n,e,t,r=A(n)){var y,k,h;const s=F(e),o=[],a={type:"root",children:[]},{structure:i="classic",tabindex:c="0"}=e;let l={type:"element",tagName:"pre",properties:{class:`shiki ${e.themeName||""}`,style:e.rootStyle||`background-color:${e.bg};color:${e.fg}`,...c!==!1&&c!=null?{tabindex:c.toString()}:{},...Object.fromEntries(Array.from(Object.entries(e.meta||{})).filter(([d])=>!d.startsWith("_")))},children:[]},g={type:"element",tagName:"code",properties:{},children:o};const f=[],u={...t,structure:i,addClassToHast:ge,get source(){return t.source},get tokens(){return n},get options(){return e},get root(){return a},get pre(){return l},get code(){return g},get lines(){return f}};if(n.forEach((d,p)=>{var v,$;p&&(i==="inline"?a.children.push({type:"element",tagName:"br",properties:{},children:[]}):i==="classic"&&o.push({type:"text",value:`
`}));let b={type:"element",tagName:"span",properties:{class:"line"},children:[]},w=0;for(const S of d){let L={type:"element",tagName:"span",properties:{...S.htmlAttrs},children:[{type:"text",value:S.content}]};const H=je(S.htmlStyle||he(S));H&&(L.properties.style=H);for(const M of s)L=((v=M==null?void 0:M.span)==null?void 0:v.call(u,L,p+1,w,b,S))||L;i==="inline"?a.children.push(L):i==="classic"&&b.children.push(L),w+=S.content.length}if(i==="classic"){for(const S of s)b=(($=S==null?void 0:S.line)==null?void 0:$.call(u,b,p+1))||b;f.push(b),o.push(b)}}),i==="classic"){for(const d of s)g=((y=d==null?void 0:d.code)==null?void 0:y.call(u,g))||g;l.children.push(g);for(const d of s)l=((k=d==null?void 0:d.pre)==null?void 0:k.call(u,l))||l;a.children.push(l)}let m=a;for(const d of s)m=((h=d==null?void 0:d.root)==null?void 0:h.call(u,m))||m;return r&&J(m,r),m}function Ze(n){return n.map(e=>{const t=[];let r="",s=0;return e.forEach((o,a)=>{const c=!(o.fontStyle&&o.fontStyle&x.Underline);c&&o.content.match(/^\s+$/)&&e[a+1]?(s||(s=o.offset),r+=o.content):r?(c?t.push({...o,offset:s,content:r+o.content}):t.push({content:r,offset:s},o),s=0,r=""):t.push(o)}),t})}function et(n){return n.map(e=>e.flatMap(t=>{if(t.content.match(/^\s+$/))return t;const r=t.content.match(/^(\s*)(.*?)(\s*)$/);if(!r)return t;const[,s,o,a]=r;if(!s&&!a)return t;const i=[{...t,offset:t.offset+s.length,content:o}];return s&&i.unshift({content:s,offset:t.offset}),a&&i.push({content:a,offset:t.offset+s.length+o.length}),i}))}const tt=Le;function ye(n,e,t){var o;const r={meta:{},options:t,codeToHast:(a,i)=>R(n,a,i),codeToTokens:(a,i)=>G(n,a,i)};let s=tt(R(n,e,t,r));for(const a of F(t))s=((o=a.postprocess)==null?void 0:o.call(r,s,t))||s;return s}const ae={light:"#333333",dark:"#bbbbbb"},ie={light:"#fffffe",dark:"#1e1e1e"},ce="__shiki_resolved";function ee(n){var i,c,l,g,f;if(n!=null&&n[ce])return n;const e={...n};e.tokenColors&&!e.settings&&(e.settings=e.tokenColors,delete e.tokenColors),e.type||(e.type="dark"),e.colorReplacements={...e.colorReplacements},e.settings||(e.settings=[]);let{bg:t,fg:r}=e;if(!t||!r){const u=e.settings?e.settings.find(m=>!m.name&&!m.scope):void 0;(i=u==null?void 0:u.settings)!=null&&i.foreground&&(r=u.settings.foreground),(c=u==null?void 0:u.settings)!=null&&c.background&&(t=u.settings.background),!r&&((l=e==null?void 0:e.colors)!=null&&l["editor.foreground"])&&(r=e.colors["editor.foreground"]),!t&&((g=e==null?void 0:e.colors)!=null&&g["editor.background"])&&(t=e.colors["editor.background"]),r||(r=e.type==="light"?ae.light:ae.dark),t||(t=e.type==="light"?ie.light:ie.dark),e.fg=r,e.bg=t}e.settings[0]&&e.settings[0].settings&&!e.settings[0].scope||e.settings.unshift({settings:{foreground:e.fg,background:e.bg}});let s=0;const o=new Map;function a(u){var y;if(o.has(u))return o.get(u);s+=1;const m=`#${s.toString(16).padStart(8,"0").toLowerCase()}`;return(y=e.colorReplacements)!=null&&y[`#${m}`]?a(u):(o.set(u,m),m)}e.settings=e.settings.map(u=>{var h,d;const m=((h=u.settings)==null?void 0:h.foreground)&&!u.settings.foreground.startsWith("#"),y=((d=u.settings)==null?void 0:d.background)&&!u.settings.background.startsWith("#");if(!m&&!y)return u;const k={...u,settings:{...u.settings}};if(m){const p=a(u.settings.foreground);e.colorReplacements[p]=u.settings.foreground,k.settings.foreground=p}if(y){const p=a(u.settings.background);e.colorReplacements[p]=u.settings.background,k.settings.background=p}return k});for(const u of Object.keys(e.colors||{}))if((u==="editor.foreground"||u==="editor.background"||u.startsWith("terminal.ansi"))&&!((f=e.colors[u])!=null&&f.startsWith("#"))){const m=a(e.colors[u]);e.colorReplacements[m]=e.colors[u],e.colors[u]=m}return Object.defineProperty(e,ce,{enumerable:!1,writable:!1,value:!0}),e}async function be(n){return Array.from(new Set((await Promise.all(n.filter(e=>!fe(e)).map(async e=>await le(e).then(t=>Array.isArray(t)?t:[t])))).flat()))}async function ke(n){return(await Promise.all(n.map(async t=>ue(t)?null:ee(await le(t))))).filter(t=>!!t)}let W=3,Te=!1;function ht(n=!0,e=!1){W=n,Te=e}function nt(n,e=3){if(W&&!(typeof W=="number"&&e>W)){if(Te)throw new Error(`[SHIKI DEPRECATE]: ${n}`);console.trace(`[SHIKI DEPRECATE]: ${n}`)}}class B extends Error{constructor(e){super(e),this.name="ShikiError"}}class rt extends Ce{constructor(t,r,s,o={}){super(t);_(this,"_resolvedThemes",new Map);_(this,"_resolvedGrammars",new Map);_(this,"_langMap",new Map);_(this,"_langGraph",new Map);_(this,"_textmateThemeCache",new WeakMap);_(this,"_loadedThemesCache",null);_(this,"_loadedLanguagesCache",null);this._resolver=t,this._themes=r,this._langs=s,this._alias=o,this._themes.map(a=>this.loadTheme(a)),this.loadLanguages(this._langs)}getTheme(t){return typeof t=="string"?this._resolvedThemes.get(t):this.loadTheme(t)}loadTheme(t){const r=ee(t);return r.name&&(this._resolvedThemes.set(r.name,r),this._loadedThemesCache=null),r}getLoadedThemes(){return this._loadedThemesCache||(this._loadedThemesCache=[...this._resolvedThemes.keys()]),this._loadedThemesCache}setTheme(t){let r=this._textmateThemeCache.get(t);r||(r=xe.createFromRawTheme(t),this._textmateThemeCache.set(t,r)),this._syncRegistry.setTheme(r)}getGrammar(t){if(this._alias[t]){const r=new Set([t]);for(;this._alias[t];){if(t=this._alias[t],r.has(t))throw new B(`Circular alias \`${Array.from(r).join(" -> ")} -> ${t}\``);r.add(t)}}return this._resolvedGrammars.get(t)}loadLanguage(t){var a,i,c,l;if(this.getGrammar(t.name))return;const r=new Set([...this._langMap.values()].filter(g=>{var f;return(f=g.embeddedLangsLazy)==null?void 0:f.includes(t.name)}));this._resolver.addLanguage(t);const s={balancedBracketSelectors:t.balancedBracketSelectors||["*"],unbalancedBracketSelectors:t.unbalancedBracketSelectors||[]};this._syncRegistry._rawGrammars.set(t.scopeName,t);const o=this.loadGrammarWithConfiguration(t.scopeName,1,s);if(o.name=t.name,this._resolvedGrammars.set(t.name,o),t.aliases&&t.aliases.forEach(g=>{this._alias[g]=t.name}),this._loadedLanguagesCache=null,r.size)for(const g of r)this._resolvedGrammars.delete(g.name),this._loadedLanguagesCache=null,(i=(a=this._syncRegistry)==null?void 0:a._injectionGrammars)==null||i.delete(g.scopeName),(l=(c=this._syncRegistry)==null?void 0:c._grammars)==null||l.delete(g.scopeName),this.loadLanguage(this._langMap.get(g.name))}dispose(){super.dispose(),this._resolvedThemes.clear(),this._resolvedGrammars.clear(),this._langMap.clear(),this._langGraph.clear(),this._loadedThemesCache=null}loadLanguages(t){for(const o of t)this.resolveEmbeddedLanguages(o);const r=Array.from(this._langGraph.entries()),s=r.filter(([o,a])=>!a);if(s.length){const o=r.filter(([a,i])=>{var c;return i&&((c=i.embeddedLangs)==null?void 0:c.some(l=>s.map(([g])=>g).includes(l)))}).filter(a=>!s.includes(a));throw new B(`Missing languages ${s.map(([a])=>`\`${a}\``).join(", ")}, required by ${o.map(([a])=>`\`${a}\``).join(", ")}`)}for(const[o,a]of r)this._resolver.addLanguage(a);for(const[o,a]of r)this.loadLanguage(a)}getLoadedLanguages(){return this._loadedLanguagesCache||(this._loadedLanguagesCache=[...new Set([...this._resolvedGrammars.keys(),...Object.keys(this._alias)])]),this._loadedLanguagesCache}resolveEmbeddedLanguages(t){if(this._langMap.set(t.name,t),this._langGraph.set(t.name,t),t.embeddedLangs)for(const r of t.embeddedLangs)this._langGraph.set(r,this._langMap.get(r))}}class st{constructor(e,t){_(this,"_langs",new Map);_(this,"_scopeToLang",new Map);_(this,"_injections",new Map);_(this,"_onigLib");this._onigLib={createOnigScanner:r=>e.createScanner(r),createOnigString:r=>e.createString(r)},t.forEach(r=>this.addLanguage(r))}get onigLib(){return this._onigLib}getLangRegistration(e){return this._langs.get(e)}loadGrammar(e){return this._scopeToLang.get(e)}addLanguage(e){this._langs.set(e.name,e),e.aliases&&e.aliases.forEach(t=>{this._langs.set(t,e)}),this._scopeToLang.set(e.scopeName,e),e.injectTo&&e.injectTo.forEach(t=>{this._injections.get(t)||this._injections.set(t,[]),this._injections.get(t).push(e.scopeName)})}getInjections(e){const t=e.split(".");let r=[];for(let s=1;s<=t.length;s++){const o=t.slice(0,s).join(".");r=[...r,...this._injections.get(o)||[]]}return r}}let O=0;function we(n){O+=1,n.warnings!==!1&&O>=10&&O%10===0&&console.warn(`[Shiki] ${O} instances have been created. Shiki is supposed to be used as a singleton, consider refactoring your code to cache your highlighter instance; Or call \`highlighter.dispose()\` to release unused instances.`);let e=!1;if(!n.engine)throw new B("`engine` option is required for synchronous mode");const t=(n.langs||[]).flat(1),r=(n.themes||[]).flat(1).map(ee),s=new st(n.engine,t),o=new rt(s,r,t,n.langAlias);let a;function i(p){h();const b=o.getGrammar(typeof p=="string"?p:p.name);if(!b)throw new B(`Language \`${p}\` not found, you may need to load it first`);return b}function c(p){if(p==="none")return{bg:"",fg:"",name:"none",settings:[],type:"dark"};h();const b=o.getTheme(p);if(!b)throw new B(`Theme \`${p}\` not found, you may need to load it first`);return b}function l(p){h();const b=c(p);a!==p&&(o.setTheme(b),a=p);const w=o.getColorMap();return{theme:b,colorMap:w}}function g(){return h(),o.getLoadedThemes()}function f(){return h(),o.getLoadedLanguages()}function u(...p){h(),o.loadLanguages(p.flat(1))}async function m(...p){return u(await be(p))}function y(...p){h();for(const b of p.flat(1))o.loadTheme(b)}async function k(...p){return h(),y(await ke(p))}function h(){if(e)throw new B("Shiki instance has been disposed")}function d(){e||(e=!0,o.dispose(),O-=1)}return{setTheme:l,getTheme:c,getLanguage:i,getLoadedThemes:g,getLoadedLanguages:f,loadLanguage:m,loadLanguageSync:u,loadTheme:k,loadThemeSync:y,dispose:d,[Symbol.dispose]:d}}async function ot(n){n.engine||nt("`engine` option is required. Use `createOnigurumaEngine` or `createJavaScriptRegexEngine` to create an engine.");const[e,t,r]=await Promise.all([ke(n.themes||[]),be(n.langs||[]),n.engine]);return we({...n,themes:e,langs:t,engine:r})}async function Se(n){const e=await ot(n);return{getLastGrammarState:(...t)=>pe(e,...t),codeToTokensBase:(t,r)=>V(e,t,r),codeToTokensWithThemes:(t,r)=>Z(e,t,r),codeToTokens:(t,r)=>G(e,t,r),codeToHast:(t,r)=>R(e,t,r),codeToHtml:(t,r)=>ye(e,t,r),getBundledLanguages:()=>({}),getBundledThemes:()=>({}),...e,getInternalContext:()=>e}}function dt(n){const e=we(n);return{getLastGrammarState:(...t)=>pe(e,...t),codeToTokensBase:(t,r)=>V(e,t,r),codeToTokensWithThemes:(t,r)=>Z(e,t,r),codeToTokens:(t,r)=>G(e,t,r),codeToHast:(t,r)=>R(e,t,r),codeToHtml:(t,r)=>ye(e,t,r),getBundledLanguages:()=>({}),getBundledThemes:()=>({}),...e,getInternalContext:()=>e}}function at(n){let e;async function t(r){if(e){const s=await e;return await Promise.all([s.loadTheme(...r.themes||[]),s.loadLanguage(...r.langs||[])]),s}else return e=n({...r,themes:r.themes||[],langs:r.langs||[]}),e}return t}const mt=at(Se);function pt(n){const e=n.langs,t=n.themes,r=n.engine;async function s(o){function a(f){if(typeof f=="string"){if(fe(f))return[];const u=e[f];if(!u)throw new T(`Language \`${f}\` is not included in this bundle. You may want to load it from external source.`);return u}return f}function i(f){if(ue(f))return"none";if(typeof f=="string"){const u=t[f];if(!u)throw new T(`Theme \`${f}\` is not included in this bundle. You may want to load it from external source.`);return u}return f}const c=(o.themes??[]).map(f=>i(f)),l=(o.langs??[]).map(f=>a(f)),g=await Se({engine:o.engine??r(),...o,themes:c,langs:l});return{...g,loadLanguage(...f){return g.loadLanguage(...f.map(a))},loadTheme(...f){return g.loadTheme(...f.map(i))},getBundledLanguages(){return e},getBundledThemes(){return t}}}return s}function it(n){let e;async function t(r={}){if(e){const s=await e;return await Promise.all([s.loadTheme(...r.themes||[]),s.loadLanguage(...r.langs||[])]),s}else return e=n({...r,themes:r.themes||[],langs:r.langs||[]}),e}return t}function yt(n,e){const t=it(n);async function r(s,o){var c;const a=await t({langs:[o.lang],themes:"theme"in o?[o.theme]:Object.values(o.themes)}),i=await((c=e==null?void 0:e.guessEmbeddedLanguages)==null?void 0:c.call(e,s,o.lang,a));return i&&await a.loadLanguage(...i),a}return{getSingletonHighlighter(s){return t(s)},async codeToHtml(s,o){return(await r(s,o)).codeToHtml(s,o)},async codeToHast(s,o){return(await r(s,o)).codeToHast(s,o)},async codeToTokens(s,o){return(await r(s,o)).codeToTokens(s,o)},async codeToTokensBase(s,o){return(await r(s,o)).codeToTokensBase(s,o)},async codeToTokensWithThemes(s,o){return(await r(s,o)).codeToTokensWithThemes(s,o)},async getLastGrammarState(s,o){return(await t({langs:[o.lang],themes:[o.theme]})).getLastGrammarState(s,o)}}}function bt(n={}){var a;const{name:e="css-variables",variablePrefix:t="--shiki-",fontStyle:r=!0}=n,s=i=>{var c;return(c=n.variableDefaults)!=null&&c[i]?`var(${t}${i}, ${n.variableDefaults[i]})`:`var(${t}${i})`},o={name:e,type:"dark",colors:{"editor.foreground":s("foreground"),"editor.background":s("background"),"terminal.ansiBlack":s("ansi-black"),"terminal.ansiRed":s("ansi-red"),"terminal.ansiGreen":s("ansi-green"),"terminal.ansiYellow":s("ansi-yellow"),"terminal.ansiBlue":s("ansi-blue"),"terminal.ansiMagenta":s("ansi-magenta"),"terminal.ansiCyan":s("ansi-cyan"),"terminal.ansiWhite":s("ansi-white"),"terminal.ansiBrightBlack":s("ansi-bright-black"),"terminal.ansiBrightRed":s("ansi-bright-red"),"terminal.ansiBrightGreen":s("ansi-bright-green"),"terminal.ansiBrightYellow":s("ansi-bright-yellow"),"terminal.ansiBrightBlue":s("ansi-bright-blue"),"terminal.ansiBrightMagenta":s("ansi-bright-magenta"),"terminal.ansiBrightCyan":s("ansi-bright-cyan"),"terminal.ansiBrightWhite":s("ansi-bright-white")},tokenColors:[{scope:["keyword.operator.accessor","meta.group.braces.round.function.arguments","meta.template.expression","markup.fenced_code meta.embedded.block"],settings:{foreground:s("foreground")}},{scope:"emphasis",settings:{fontStyle:"italic"}},{scope:["strong","markup.heading.markdown","markup.bold.markdown"],settings:{fontStyle:"bold"}},{scope:["markup.italic.markdown"],settings:{fontStyle:"italic"}},{scope:"meta.link.inline.markdown",settings:{fontStyle:"underline",foreground:s("token-link")}},{scope:["string","markup.fenced_code","markup.inline"],settings:{foreground:s("token-string")}},{scope:["comment","string.quoted.docstring.multi"],settings:{foreground:s("token-comment")}},{scope:["constant.numeric","constant.language","constant.other.placeholder","constant.character.format.placeholder","variable.language.this","variable.other.object","variable.other.class","variable.other.constant","meta.property-name","meta.property-value","support"],settings:{foreground:s("token-constant")}},{scope:["keyword","storage.modifier","storage.type","storage.control.clojure","entity.name.function.clojure","entity.name.tag.yaml","support.function.node","support.type.property-name.json","punctuation.separator.key-value","punctuation.definition.template-expression"],settings:{foreground:s("token-keyword")}},{scope:"variable.parameter.function",settings:{foreground:s("token-parameter")}},{scope:["support.function","entity.name.type","entity.other.inherited-class","meta.function-call","meta.instance.constructor","entity.other.attribute-name","entity.name.function","constant.keyword.clojure"],settings:{foreground:s("token-function")}},{scope:["entity.name.tag","string.quoted","string.regexp","string.interpolated","string.template","string.unquoted.plain.out.yaml","keyword.other.template"],settings:{foreground:s("token-string-expression")}},{scope:["punctuation.definition.arguments","punctuation.definition.dict","punctuation.separator","meta.function-call.arguments"],settings:{foreground:s("token-punctuation")}},{scope:["markup.underline.link","punctuation.definition.metadata.markdown"],settings:{foreground:s("token-link")}},{scope:["beginning.punctuation.definition.list.markdown"],settings:{foreground:s("token-string")}},{scope:["punctuation.definition.string.begin.markdown","punctuation.definition.string.end.markdown","string.other.link.title.markdown","string.other.link.description.markdown"],settings:{foreground:s("token-keyword")}},{scope:["markup.inserted","meta.diff.header.to-file","punctuation.definition.inserted"],settings:{foreground:s("token-inserted")}},{scope:["markup.deleted","meta.diff.header.from-file","punctuation.definition.deleted"],settings:{foreground:s("token-deleted")}},{scope:["markup.changed","punctuation.definition.changed"],settings:{foreground:s("token-changed")}}]};return r||(o.tokenColors=(a=o.tokenColors)==null?void 0:a.map(i=>{var c;return(c=i.settings)!=null&&c.fontStyle&&delete i.settings.fontStyle,i})),o}export{T as ShikiError,ge as addClassToHast,N as applyColorReplacements,R as codeToHast,ye as codeToHtml,G as codeToTokens,V as codeToTokensBase,Z as codeToTokensWithThemes,bt as createCssVariablesTheme,Se as createHighlighterCore,dt as createHighlighterCoreSync,Ne as createPositionConverter,ot as createShikiInternal,we as createShikiInternalSync,yt as createSingletonShorthands,pt as createdBundledHighlighter,ht as enableDeprecationWarnings,Be as flatTokenVariants,mt as getSingletonHighlighterCore,he as getTokenStyleObject,gt as guessEmbeddedLanguages,tt as hastToHtml,X as isNoneTheme,Q as isPlainLang,fe as isSpecialLang,ue as isSpecialTheme,it as makeSingletonHighlighter,at as makeSingletonHighlighterCore,le as normalizeGetter,ee as normalizeTheme,P as resolveColorReplacements,z as splitLines,Ee as splitToken,Ie as splitTokens,je as stringifyTokenStyle,$e as toArray,ze as tokenizeAnsiWithTheme,Ve as tokenizeWithTheme,Xe as tokensToHast,Ae as transformerDecorations,nt as warnDeprecated};
