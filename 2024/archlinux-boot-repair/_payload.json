[{"data":1,"prerenderedAt":710},["ShallowReactive",2],{"/2024/archlinux-boot-repair":3,"surround-/2024/archlinux-boot-repair":700},{"_path":4,"_dir":5,"_draft":6,"_partial":6,"_locale":7,"title":8,"description":9,"date":10,"updated":11,"image":12,"categories":13,"tags":15,"references":19,"readingTime":23,"body":28,"_type":693,"_id":694,"_source":695,"_file":696,"_stem":697,"_extension":698,"_original_dir":699},"/2024/archlinux-boot-repair","2024",false,"","Arch Linux 启动引导修复","可以修复绝大多数 Arch Linux 无法启动的问题。","2024-04-01T15:14:39.000Z","2025-03-04T14:30:59.000Z","https://7.isyangs.cn/24/66640097e0cbb-24.jpg",[14],"经验分享",[16,17,18],"教程","系统","archlinux",[20],{"title":21,"link":22},"systemd-boot - Arch Linux 中文维基","https://wiki.archlinuxcn.org/wiki/Systemd-boot",{"text":24,"minutes":25,"time":26,"words":27},"3 min read",2.765,165900,553,{"type":29,"children":30,"toc":685},"root",[31,40,55,61,177,182,259,264,330,336,348,469,474,643,648,653,679],{"type":32,"tag":33,"props":34,"children":36},"element","h2",{"id":35},"制作启动盘进入并联网",[37],{"type":38,"value":39},"text","制作启动盘、进入并联网",{"type":32,"tag":41,"props":42,"children":43},"p",{},[44,46,53],{"type":38,"value":45},"参见 ",{"type":32,"tag":47,"props":48,"children":50},"a",{"href":49},"/2023/archinstall-guide",[51],{"type":38,"value":52},"使用 ArchInstall 安装 Arch Linux",{"type":38,"value":54}," 的“安装前准备”一节。",{"type":32,"tag":33,"props":56,"children":58},{"id":57},"挂载分区进入系统",[59],{"type":38,"value":60},"挂载分区、进入系统",{"type":32,"tag":62,"props":63,"children":64},"ul",{},[65,77,128,159,168],{"type":32,"tag":66,"props":67,"children":68},"li",{},[69,71],{"type":38,"value":70},"如果不了解你的硬盘分区，可以执行以下命令：\n",{"type":32,"tag":72,"props":73,"children":76},"copy",{"code":74,"prompt":75},"lsblk -f","#",[],{"type":32,"tag":66,"props":78,"children":79},{},[80,82],{"type":38,"value":81},"先挂载根目录所在的分区：\n",{"type":32,"tag":62,"props":83,"children":84},{},[85,94],{"type":32,"tag":66,"props":86,"children":87},{},[88,90],{"type":38,"value":89},"非 BtrFS 分区\n",{"type":32,"tag":72,"props":91,"children":93},{"code":92,"prompt":75},"mount /dev/[根分区] /mnt",[],{"type":32,"tag":66,"props":95,"children":96},{},[97,99],{"type":38,"value":98},"如果根分区使用 BtrFS，需要知道子卷名，如果没有子卷可以跳过此步\n",{"type":32,"tag":62,"props":100,"children":101},{},[102,115],{"type":32,"tag":66,"props":103,"children":104},{},[105,107,111],{"type":38,"value":106},"可以通过先挂载 BtrFS，然后通过以下命令之一查看子卷名\n",{"type":32,"tag":72,"props":108,"children":110},{"code":109,"prompt":75},"ls /mnt",[],{"type":32,"tag":72,"props":112,"children":114},{"code":113,"prompt":75},"btrfs subvolume list /[挂载点]",[],{"type":32,"tag":66,"props":116,"children":117},{},[118,120,124],{"type":38,"value":119},"随后解除 /mnt 的挂载并重新挂载对应的子卷\n",{"type":32,"tag":72,"props":121,"children":123},{"code":122,"prompt":75},"umount /mnt",[],{"type":32,"tag":72,"props":125,"children":127},{"code":126,"prompt":75},"mount /dev/[根分区] -t btrfs -o subvol=[子卷名] /mnt",[],{"type":32,"tag":66,"props":129,"children":130},{},[131,133],{"type":38,"value":132},"随后挂载其他分区：\n",{"type":32,"tag":62,"props":134,"children":135},{},[136,145,154],{"type":32,"tag":66,"props":137,"children":138},{},[139,141],{"type":38,"value":140},"挂载启动分区\n",{"type":32,"tag":72,"props":142,"children":144},{"code":143,"prompt":75},"mount /dev/[启动分区] /mnt/boot",[],{"type":32,"tag":66,"props":146,"children":147},{},[148,150],{"type":38,"value":149},"查看先前的挂载方式，有助于你的回忆\n",{"type":32,"tag":72,"props":151,"children":153},{"code":152,"prompt":75},"cat /mnt/etc/fstab",[],{"type":32,"tag":66,"props":155,"children":156},{},[157],{"type":38,"value":158},"如果回忆起有其他分区，请继续挂载",{"type":32,"tag":66,"props":160,"children":161},{},[162,164],{"type":38,"value":163},"可以将此时的挂载方式写入原系统：\n",{"type":32,"tag":72,"props":165,"children":167},{"code":166,"prompt":75},"genfstab -U /mnt > /mnt/etc/fstab",[],{"type":32,"tag":66,"props":169,"children":170},{},[171,173],{"type":38,"value":172},"随后就可以进入原系统了\n",{"type":32,"tag":72,"props":174,"children":176},{"code":175,"prompt":75},"arch-chroot /mnt",[],{"type":32,"tag":33,"props":178,"children":180},{"id":179},"修复一些可能导致无法进入的问题",[181],{"type":38,"value":179},{"type":32,"tag":62,"props":183,"children":184},{},[185,202],{"type":32,"tag":66,"props":186,"children":187},{},[188,190,196,198],{"type":38,"value":189},"如果忘记 ",{"type":32,"tag":191,"props":192,"children":194},"code",{"className":193},[],[195],{"type":38,"value":29},{"type":38,"value":197}," 用户密码，可以执行以下命令：\n",{"type":32,"tag":72,"props":199,"children":201},{"code":200,"prompt":75},"passwd",[],{"type":32,"tag":66,"props":203,"children":204},{},[205,207,213,215,219,227,231,235,243,247,255],{"type":38,"value":206},"同时，还可以更新一下系统的软件包，",{"type":32,"tag":208,"props":209,"children":210},"strong",{},[211],{"type":38,"value":212},"说不定有用呢",{"type":38,"value":214},"：\n",{"type":32,"tag":72,"props":216,"children":218},{"code":217,"prompt":75},"pacman -Syyuu",[],{"type":32,"tag":62,"props":220,"children":221},{},[222],{"type":32,"tag":66,"props":223,"children":224},{},[225],{"type":38,"value":226},"如果更新缓慢，可以换源",{"type":32,"tag":72,"props":228,"children":230},{"code":229,"prompt":75},"pacman -S reflector",[],{"type":32,"tag":72,"props":232,"children":234},{"code":233,"prompt":75},"reflector --verbose --country China --sort rate --save /etc/pacman.d/mirrorlist",[],{"type":32,"tag":62,"props":236,"children":237},{},[238],{"type":32,"tag":66,"props":239,"children":240},{},[241],{"type":38,"value":242},"如果提醒无法锁定数据库，可以删除锁文件",{"type":32,"tag":72,"props":244,"children":246},{"code":245,"prompt":75},"rm /var/lib/pacman/db.lck",[],{"type":32,"tag":62,"props":248,"children":249},{},[250],{"type":32,"tag":66,"props":251,"children":252},{},[253],{"type":38,"value":254},"如果提醒某文件已存在，可以强制覆盖",{"type":32,"tag":72,"props":256,"children":258},{"code":257,"prompt":75},"pacman -Syu --overwrite \"*\"",[],{"type":32,"tag":33,"props":260,"children":262},{"id":261},"修复引导",[263],{"type":38,"value":261},{"type":32,"tag":62,"props":265,"children":266},{},[267,276,309],{"type":32,"tag":66,"props":268,"children":269},{},[270,272],{"type":38,"value":271},"安装 Linux 包可以触发 mkinitcpio\n",{"type":32,"tag":72,"props":273,"children":275},{"code":274,"prompt":75},"pacman -S linux",[],{"type":32,"tag":66,"props":277,"children":278},{},[279,281,285,293,297,305],{"type":38,"value":280},"如果使用 systemd-boot，请执行以下命令\n",{"type":32,"tag":72,"props":282,"children":284},{"code":283,"prompt":75},"bootctl install",[],{"type":32,"tag":62,"props":286,"children":287},{},[288],{"type":32,"tag":66,"props":289,"children":290},{},[291],{"type":38,"value":292},"使用此命令检测 EFI 引导项和 Boot Loader 配置",{"type":32,"tag":72,"props":294,"children":296},{"code":295,"prompt":75},"bootctl list",[],{"type":32,"tag":62,"props":298,"children":299},{},[300],{"type":32,"tag":66,"props":301,"children":302},{},[303],{"type":38,"value":304},"如果屏幕显示不全，可以使用交互模式，按 q 退出",{"type":32,"tag":72,"props":306,"children":308},{"code":307,"prompt":75},"bootctl",[],{"type":32,"tag":66,"props":310,"children":311},{},[312,314,318,326],{"type":38,"value":313},"如果使用 grub，请执行以下命令\n",{"type":32,"tag":72,"props":315,"children":317},{"code":316,"prompt":75},"grub-install",[],{"type":32,"tag":62,"props":319,"children":320},{},[321],{"type":32,"tag":66,"props":322,"children":323},{},[324],{"type":38,"value":325},"备用命令，也可以自行在网上搜索",{"type":32,"tag":72,"props":327,"children":329},{"code":328,"prompt":75},"grub-install --target=x86_64-efi --efi-directory=/boot/efi --bootloader-id=grub",[],{"type":32,"tag":33,"props":331,"children":333},{"id":332},"为-systemd-boot-添加引导项",[334],{"type":38,"value":335},"为 systemd-boot 添加引导项",{"type":32,"tag":41,"props":337,"children":338},{},[339,341,346],{"type":38,"value":340},"如果 ",{"type":32,"tag":191,"props":342,"children":344},{"className":343},[],[345],{"type":38,"value":295},{"type":38,"value":347}," 显示没有 Arch Linux，那么需要写入以下文件：",{"type":32,"tag":349,"props":350,"children":355},"pre",{"className":351,"code":352,"filename":353,"language":354,"meta":7,"style":7},"language-sh shiki shiki-themes catppuccin-latte one-dark-pro","title   Arch Linux (linux)\nlinux   /vmlinuz-linux\ninitrd  /intel-ucode.img\ninitrd  /initramfs-linux.img\noptions root=PARTUUID=692afe0d-e1d7-4e0f-970f-1ed04e0c07e9 zswap.enabled=0 rootflags=subvol=@ rw rootfstype=btrfs\n","/boot/loader/entries/arch.conf","sh",[356],{"type":32,"tag":191,"props":357,"children":358},{"__ignoreMap":7},[359,388,402,416,429],{"type":32,"tag":360,"props":361,"children":364},"span",{"class":362,"line":363},"line",1,[365,371,377,382],{"type":32,"tag":360,"props":366,"children":368},{"style":367},"--shiki-default:#1E66F5;--shiki-default-font-style:italic;--shiki-dark:#61AFEF;--shiki-dark-font-style:inherit",[369],{"type":38,"value":370},"title",{"type":32,"tag":360,"props":372,"children":374},{"style":373},"--shiki-default:#40A02B;--shiki-dark:#98C379",[375],{"type":38,"value":376},"   Arch",{"type":32,"tag":360,"props":378,"children":379},{"style":373},[380],{"type":38,"value":381}," Linux",{"type":32,"tag":360,"props":383,"children":385},{"style":384},"--shiki-default:#4C4F69;--shiki-dark:#ABB2BF",[386],{"type":38,"value":387}," (linux)\n",{"type":32,"tag":360,"props":389,"children":391},{"class":362,"line":390},2,[392,397],{"type":32,"tag":360,"props":393,"children":394},{"style":367},[395],{"type":38,"value":396},"linux",{"type":32,"tag":360,"props":398,"children":399},{"style":373},[400],{"type":38,"value":401},"   /vmlinuz-linux\n",{"type":32,"tag":360,"props":403,"children":405},{"class":362,"line":404},3,[406,411],{"type":32,"tag":360,"props":407,"children":408},{"style":367},[409],{"type":38,"value":410},"initrd",{"type":32,"tag":360,"props":412,"children":413},{"style":373},[414],{"type":38,"value":415},"  /intel-ucode.img\n",{"type":32,"tag":360,"props":417,"children":419},{"class":362,"line":418},4,[420,424],{"type":32,"tag":360,"props":421,"children":422},{"style":367},[423],{"type":38,"value":410},{"type":32,"tag":360,"props":425,"children":426},{"style":373},[427],{"type":38,"value":428},"  /initramfs-linux.img\n",{"type":32,"tag":360,"props":430,"children":432},{"class":362,"line":431},5,[433,438,443,448,454,459,464],{"type":32,"tag":360,"props":434,"children":435},{"style":367},[436],{"type":38,"value":437},"options",{"type":32,"tag":360,"props":439,"children":440},{"style":373},[441],{"type":38,"value":442}," root=PARTUUID=692afe0d-e1d7-4e0f-970f-1ed04e0c07e9",{"type":32,"tag":360,"props":444,"children":445},{"style":373},[446],{"type":38,"value":447}," zswap.enabled=",{"type":32,"tag":360,"props":449,"children":451},{"style":450},"--shiki-default:#FE640B;--shiki-dark:#D19A66",[452],{"type":38,"value":453},"0",{"type":32,"tag":360,"props":455,"children":456},{"style":373},[457],{"type":38,"value":458}," rootflags=subvol=@",{"type":32,"tag":360,"props":460,"children":461},{"style":373},[462],{"type":38,"value":463}," rw",{"type":32,"tag":360,"props":465,"children":466},{"style":373},[467],{"type":38,"value":468}," rootfstype=btrfs\n",{"type":32,"tag":41,"props":470,"children":471},{},[472],{"type":38,"value":473},"请注意：",{"type":32,"tag":475,"props":476,"children":477},"ol",{},[478,567,579],{"type":32,"tag":66,"props":479,"children":480},{},[481,483,497,499,511,513],{"type":38,"value":482},"PARTUUID 和 UUID 不同，",{"type":32,"tag":191,"props":484,"children":485},{"className":351,"language":354,"style":7},[486,491],{"type":32,"tag":360,"props":487,"children":488},{"style":367},[489],{"type":38,"value":490},"lsblk",{"type":32,"tag":360,"props":492,"children":494},{"style":493},"--shiki-default:#40A02B;--shiki-dark:#D19A66",[495],{"type":38,"value":496}," -f",{"type":38,"value":498}," 命令显示的是 UUID，你可以通过 ",{"type":32,"tag":191,"props":500,"children":501},{"className":351,"language":354,"style":7},[502,506],{"type":32,"tag":360,"props":503,"children":504},{"style":367},[505],{"type":38,"value":490},{"type":32,"tag":360,"props":507,"children":508},{"style":493},[509],{"type":38,"value":510}," -o+UUID,PARTUUID",{"type":38,"value":512}," 发现两者的区别。\n",{"type":32,"tag":62,"props":514,"children":515},{},[516,525],{"type":32,"tag":66,"props":517,"children":518},{},[519,521],{"type":38,"value":520},"查看 PARTUUID 并追加到文件中\n",{"type":32,"tag":72,"props":522,"children":524},{"code":523,"prompt":75},"blkid -s PARTUUID -o value /dev/[根分区] >> /boot/loader/entries/arch.conf",[],{"type":32,"tag":66,"props":526,"children":527},{},[528,530,538,540,563],{"type":38,"value":529},"查看 UUID 并追加到文件中，需要 ",{"type":32,"tag":191,"props":531,"children":532},{"className":351,"language":354,"style":7},[533],{"type":32,"tag":360,"props":534,"children":535},{"style":367},[536],{"type":38,"value":537},"option",{"type":38,"value":539}," 中使用 ",{"type":32,"tag":191,"props":541,"children":542},{"className":351,"language":354,"style":7},[543,548,554,559],{"type":32,"tag":360,"props":544,"children":546},{"style":545},"--shiki-default:#4C4F69;--shiki-dark:#E06C75",[547],{"type":38,"value":29},{"type":32,"tag":360,"props":549,"children":551},{"style":550},"--shiki-default:#179299;--shiki-dark:#56B6C2",[552],{"type":38,"value":553},"=",{"type":32,"tag":360,"props":555,"children":556},{"style":545},[557],{"type":38,"value":558},"UUID",{"type":32,"tag":360,"props":560,"children":561},{"style":550},[562],{"type":38,"value":553},{"type":32,"tag":72,"props":564,"children":566},{"code":565,"prompt":75},"blkid -s UUID -o value /dev/[根分区] >> /boot/loader/entries/arch.conf",[],{"type":32,"tag":66,"props":568,"children":569},{},[570,577],{"type":32,"tag":191,"props":571,"children":572},{"className":351,"language":354,"style":7},[573],{"type":32,"tag":360,"props":574,"children":575},{"style":367},[576],{"type":38,"value":410},{"type":38,"value":578}," 中需要添加对应 CPU 的微码，没有的话可以跳过。",{"type":32,"tag":66,"props":580,"children":581},{},[582,589,591,599,601,609,611,641],{"type":32,"tag":191,"props":583,"children":584},{"className":351,"language":354,"style":7},[585],{"type":32,"tag":360,"props":586,"children":587},{"style":367},[588],{"type":38,"value":437},{"type":38,"value":590}," 中设置合适的 ",{"type":32,"tag":191,"props":592,"children":593},{"className":351,"language":354,"style":7},[594],{"type":32,"tag":360,"props":595,"children":596},{"style":367},[597],{"type":38,"value":598},"rootfstype",{"type":38,"value":600}," 和 ",{"type":32,"tag":191,"props":602,"children":603},{"className":351,"language":354,"style":7},[604],{"type":32,"tag":360,"props":605,"children":606},{"style":367},[607],{"type":38,"value":608},"rootflags",{"type":38,"value":610},"，有子卷时需要设置 ",{"type":32,"tag":191,"props":612,"children":613},{"className":351,"language":354,"style":7},[614,618,622,627,631,636],{"type":32,"tag":360,"props":615,"children":616},{"style":545},[617],{"type":38,"value":608},{"type":32,"tag":360,"props":619,"children":620},{"style":550},[621],{"type":38,"value":553},{"type":32,"tag":360,"props":623,"children":624},{"style":545},[625],{"type":38,"value":626},"subvol",{"type":32,"tag":360,"props":628,"children":629},{"style":550},[630],{"type":38,"value":553},{"type":32,"tag":360,"props":632,"children":633},{"style":373},[634],{"type":38,"value":635},"[子卷名",{"type":32,"tag":360,"props":637,"children":638},{"style":384},[639],{"type":38,"value":640},"]",{"type":38,"value":642},"。",{"type":32,"tag":33,"props":644,"children":646},{"id":645},"重启",[647],{"type":38,"value":645},{"type":32,"tag":41,"props":649,"children":650},{},[651],{"type":38,"value":652},"按 Ctrl+Alt+Delete 直接重启。",{"type":32,"tag":41,"props":654,"children":655},{},[656,658,667,669,677],{"type":38,"value":657},"更规范的方式是输入 ",{"type":32,"tag":191,"props":659,"children":660},{"className":351,"language":354,"style":7},[661],{"type":32,"tag":360,"props":662,"children":664},{"style":663},"--shiki-default:#D20F39;--shiki-default-font-style:italic;--shiki-dark:#56B6C2;--shiki-dark-font-style:inherit",[665],{"type":38,"value":666},"exit",{"type":38,"value":668}," 或按 Ctrl+D 退出 chroot 环境，然后执行 ",{"type":32,"tag":191,"props":670,"children":671},{"className":351,"language":354,"style":7},[672],{"type":32,"tag":360,"props":673,"children":674},{"style":367},[675],{"type":38,"value":676},"reboot",{"type":38,"value":678}," 命令重启。",{"type":32,"tag":680,"props":681,"children":682},"style",{},[683],{"type":38,"value":684},"html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html.dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}",{"title":7,"searchDepth":418,"depth":418,"links":686},[687,688,689,690,691,692],{"id":35,"depth":390,"text":39},{"id":57,"depth":390,"text":60},{"id":179,"depth":390,"text":179},{"id":261,"depth":390,"text":261},{"id":332,"depth":390,"text":335},{"id":645,"depth":390,"text":645},"markdown","content:posts:2024:archlinux-boot-repair.md","content","posts/2024/archlinux-boot-repair.md","posts/2024/archlinux-boot-repair","md","/posts",[701,706],{"_path":702,"title":703,"date":704,"type":705},"/2024/balancing-today-tomorrow","在延长今天和期待明天之间","2024-03-21T15:45:08.000Z","story",{"_path":707,"title":708,"date":709},"/2024/magic-code","写过的奇妙代码。","2024-04-07T04:32:11.000Z",1743388280520]